import{_ as i,o as a,c as n,ag as e}from"./chunks/framework.DEqXEGcv.js";const c=JSON.parse('{"title":"","description":"","frontmatter":{"tags":["环境配置"]},"headers":[],"relativePath":"5 工具/为 WSL2 一键设置代理.md","filePath":"5 工具/为 WSL2 一键设置代理.md","lastUpdated":1770953870000}'),t={name:"5 工具/为 WSL2 一键设置代理.md"};function p(l,s,h,r,d,k){return a(),n("div",null,[...s[0]||(s[0]=[e(`<h2 id="wsl1-和-wsl2-网络的区别" tabindex="-1">WSL1 和 WSL2 网络的区别 <a class="header-anchor" href="#wsl1-和-wsl2-网络的区别" aria-label="Permalink to &quot;WSL1 和 WSL2 网络的区别&quot;">​</a></h2> <p>在 WSL1 时代，由于 Linux 子系统和 Windows 共享了网络端口，所以访问 Windows 的代理非常简单。例如 Windows 的代理客户端监听了 8000 端口，那么只需要在 Linux 子系统中执行如下命令，就可以让当前 session 中的请求通过代理访问互联网。</p> <div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL_PROXY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://127.0.0.1:8000&quot;</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>但是 WSL2 基于 Hyper-V 运行，导致 Linux 子系统和 Windows 在网络上是两台各自独立的机器，从 Linux 子系统访问 Windows 首先需要找到 Windows 的 IP。</p> <h2 id="配置-wsl2-访问-windows-上的代理" tabindex="-1">配置 WSL2 访问 Windows 上的代理 <a class="header-anchor" href="#配置-wsl2-访问-windows-上的代理" aria-label="Permalink to &quot;配置 WSL2 访问 Windows 上的代理&quot;">​</a></h2> <p>有两个关键步骤： 1. WSL2 中配置的代理要指向 Windows 的 IP； 2. Windows 上的代理客户端需要允许来自本地局域网的请求；</p> <p>由于 Linux 子系统也是通过 Windows 访问网络，所以 Linux 子系统中的网关指向的是 Windows，DNS 服务器指向的也是 Windows，基于这两个特性，我们可以将 Windows 的 IP 读取出来。</p> <p>例如，在 Ubuntu 子系统中，通过 <code>cat /etc/resolv.conf</code> 查看 DNS 服务器 IP。</p> <div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [network]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># generateResolvConf = false</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nameserver</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.24.128.1</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>可以看到 DNS 服务器是 <code>172.24.128.1</code>，通过环境变量 <code>ALL_PROXY</code> 配置代理：</p> <div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL_PROXY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://172.24.128.1:7890&quot;</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>7890 是 Windows 上运行的代理客户端的端口，记得要在 Windows 代理客户端上配置允许本地局域网请求。</p> <p>写入 ~/. bashrc：</p> <div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;export ALL_PROXY=http://172.24.128.1:7890&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.bashrc</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.bashrc</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">hostip</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat /etc/resolv.conf </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep -oP </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&#39;(?&lt;=nameserver\\ ).*&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">export https_proxy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;http://\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">hostip</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">}:7890&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">export http_proxy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;http://\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">hostip</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">}:7890&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">export all_proxy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;socks5://\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">hostip</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">}:7890&quot;</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div>`,25)])])}const g=i(t,[["render",p]]);export{c as __pageData,g as default};
