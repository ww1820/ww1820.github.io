import{_ as a,o as n,c as i,ag as p}from"./chunks/framework.DEqXEGcv.js";const E=JSON.parse('{"title":"C++项目笔记——MyTinySTL概述","description":"","frontmatter":{"title":"C++项目笔记——MyTinySTL概述","tags":["cpp11","STL"],"categories":[["C++","项目"]],"abbrlink":"135304f3","date":"2022-07-19T14:14:31.000Z"},"headers":[],"relativePath":"2 计算机/项目/TinySTL/MyTinySTL概述.md","filePath":"2 计算机/项目/TinySTL/MyTinySTL概述.md","lastUpdated":1770953870000}'),l={name:"2 计算机/项目/TinySTL/MyTinySTL概述.md"};function e(t,s,h,r,k,d){return n(),i("div",null,[...s[0]||(s[0]=[p(`<blockquote><p>项目地址：<a href="https://github.com/ww1820/MyTinySTL" target="_blank" rel="noreferrer">ww1820/MyTinySTL: A tiny STL in C++11，练手项目 (github.com)</a></p></blockquote> <h2 id="stl-standard-template-library" tabindex="-1">STL（Standard Template Library） <a class="header-anchor" href="#stl-standard-template-library" aria-label="Permalink to &quot;STL（Standard Template Library）&quot;">​</a></h2> <ul><li>C++ Standard Library，C++ 标准库
<ul><li>C++ Standard Template Library，C++ 标准模板库</li></ul></li></ul> <p>STL 是 <strong>C++ 标准库的一部分</strong>，不用单独安装。. C++ STL 借助模板（Template）把常用的 <strong>数据结构</strong> 及其<strong>算法</strong>都实现了一遍，并且做到了数据结构和算法的<strong>分离</strong>（GP <strong>vs.</strong> OOP）。</p> <p>C++标准库以头文件的形式呈现：</p> <ul><li>新式C++头文件不带<code>.h</code> 后缀，如<code>#include&lt;vector&gt;</code></li> <li>旧式C++头文件带<code>.h</code> 后缀，如<code>#include&lt;stdio.h&gt;</code></li> <li>新式头文件内的组件封装于<code>namespace std</code></li> <li>旧式头文件内的组件不封装于<code>namespace std</code></li></ul> <h2 id="六大组件" tabindex="-1">六大组件 <a class="header-anchor" href="#六大组件" aria-label="Permalink to &quot;六大组件&quot;">​</a></h2> <ol><li>分配器（Allocators）：内存管理。</li> <li>迭代器（Iterators）：泛化的指针，算法通过迭代器访问容器中的数据。</li> <li>容器（Containers）：封装了大量常用的数据结构。</li> <li>算法（Algorithms）：定义了一些常用算法，处理数据。</li> <li>仿函数（Functors）：具有函数特质的对象（重载<code>operator()</code>的类）。</li> <li>适配器（Adapters）：修改接口。</li></ol> <p><img src="https://aweiii.coding.net/p/blog/d/img/git/raw/main/posts/STLComponents.png" alt="STLComponents" loading="lazy"></p> <h2 id="容器的分类与结构" tabindex="-1">容器的分类与结构 <a class="header-anchor" href="#容器的分类与结构" aria-label="Permalink to &quot;容器的分类与结构&quot;">​</a></h2> <ul><li>顺序容器：
<ul><li>Array：长度固定的数组，存储空间连续，支持随机访问</li> <li>Vector：动态数组，存储空间连续，支持随机访问</li> <li>Deque：双端队列，存储空间分段连续，支持随机访问</li> <li>List：双向链表，存储空间不连续，不支持随机访问</li> <li>Forward-List：单向链表，存储空间不连续，不支持随机访问</li></ul></li> <li>关联容器：红黑树实现，有序。Multi的key可以重复
<ul><li>Set/MultiSet</li> <li>Map/MultiMap</li></ul></li> <li>无序容器：哈希表（Separate Chaining）实现
<ul><li>Unoedered Set/MultiSet</li> <li>Unoedered Map/MultiMap</li></ul></li></ul> <p><img src="https://aweiii.coding.net/p/blog/d/img/git/raw/main/posts/p1.png" alt="容器的分类与结构" loading="lazy"></p> <div class="warning custom-block"><p class="custom-block-title">注意</p> <ol><li><p>C++ Primer 中指出  <code>string</code> 是与<code>vector</code>相似的容器，但专门用于保存字符。随机访问块。在尾部插入/删除速度快。</p></li> <li><p>deque由<strong>若干段</strong>连续空间串接而成，一旦有必要在deque的头部或尾端增加新的空间，便配置一段定量连续的空间，串接在deque的头部或尾端。deque的最大任务，就是在这些分段连续的空间上维护其整体连续的假象，并提供随机存取的接口。</p> <p>deque首次插入一个元素，默认会动态分配512字节空间，当这512字节空间用完后，它会再动态分配自己另外的512字节空间，然后<strong>虚拟地</strong>连在一起。<strong>deque的随机访问和遍历性能比vector差。</strong></p></li></ol></div> <h2 id="测试" tabindex="-1">测试 <a class="header-anchor" href="#测试" aria-label="Permalink to &quot;测试&quot;">​</a></h2> <h3 id="主要文件结构" tabindex="-1">主要文件结构 <a class="header-anchor" href="#主要文件结构" aria-label="Permalink to &quot;主要文件结构&quot;">​</a></h3> <div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>MyTinySTL</span></span>
<span class="line"><span>│      alloc.h       // 分配器</span></span>
<span class="line"><span>│      allocator.h   </span></span>
<span class="line"><span>│      construct.h</span></span>
<span class="line"><span>│      uninitialized.h</span></span>
<span class="line"><span>│      memory.h</span></span>
<span class="line"><span>│      iterator.h    // 迭代器</span></span>
<span class="line"><span>│      type_traits.h // 萃取器</span></span>
<span class="line"><span>│      list.h        // 容器</span></span>
<span class="line"><span>│      vector.h</span></span>
<span class="line"><span>│      deque.h</span></span>
<span class="line"><span>│      rb_tree.h</span></span>
<span class="line"><span>│      set.h</span></span>
<span class="line"><span>│      map.h</span></span>
<span class="line"><span>│      hashtable.h</span></span>
<span class="line"><span>│      unordered_map.h</span></span>
<span class="line"><span>│      unordered_set.h</span></span>
<span class="line"><span>│      astring.h</span></span>
<span class="line"><span>│      basic_string.h</span></span>
<span class="line"><span>│      queue.h</span></span>
<span class="line"><span>│      stack.h</span></span>
<span class="line"><span>│      algo.h		 // 算法</span></span>
<span class="line"><span>│      algobase.h</span></span>
<span class="line"><span>│      algorithm.h</span></span>
<span class="line"><span>│      numeric.h</span></span>
<span class="line"><span>│      heap_algo.h</span></span>
<span class="line"><span>│      set_algo.h</span></span>
<span class="line"><span>│      functional.h  //仿函数</span></span>
<span class="line"><span>│      exceptdef.h   //其他</span></span>
<span class="line"><span>│      util.h</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>└─Test       	     // 测试文件</span></span>
<span class="line"><span>    │  test.cpp      // 程序入口</span></span>
<span class="line"><span>    │  algorithm_performance_test.h</span></span>
<span class="line"><span>    │  algorithm_test.h</span></span>
<span class="line"><span>    │  deque_test.h</span></span>
<span class="line"><span>    │  list_test.h</span></span>
<span class="line"><span>    │  map_test.h</span></span>
<span class="line"><span>    │  queue_test.h</span></span>
<span class="line"><span>    │  set_test.h</span></span>
<span class="line"><span>    │  stack_test.h</span></span>
<span class="line"><span>    │  string_test.h</span></span>
<span class="line"><span>    │  test.h</span></span>
<span class="line"><span>    │  unordered_map_test.h</span></span>
<span class="line"><span>    │  unordered_set_test.h</span></span>
<span class="line"><span>    │  vector_test.h</span></span>
<span class="line"><span>    │  CMakeLists.txt</span></span>
<span class="line"><span>    │  README.md</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h3 id="测试程序" tabindex="-1">测试程序 <a class="header-anchor" href="#测试程序" aria-label="Permalink to &quot;测试程序&quot;">​</a></h3> <div class="language-CPP vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">CPP</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  using</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> namespace</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mystl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::cout.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sync_with_stdio</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //算法测试: 包含了 mystl 的 81 个算法测试 algorithm_test.h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  RUN_ALL_TESTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 仅仅针对 sort, binary_search 做了性能测试 algorithm_performance_test.h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  algorithm_performance_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">algorithm_performance_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // vector test : 测试 vector 的接口与 push_back 的性能</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  vector_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vector_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // list test : 测试 list 的接口与 insert, sort 的性能</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  list_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">list_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // deque test : 测试 deque 的接口和 push_front/push_back 的性能</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  deque_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deque_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // queue test : 测试 queue, priority_queue 的接口和它们 push 的性能</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  queue_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queue_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  queue_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">priority_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // stack test : 测试 stack 的接口 和 push 的性能</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  stack_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stack_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // map test : 测试 map, multimap 的接口与它们 insert 的性能</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  map_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  map_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multimap_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // set test : 测试 set, multiset 的接口与它们 insert 的性能</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  set_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  set_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multiset_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // unordered_map test : 测试 unordered_map, unordered_multimap 的接口与它们 insert 的性能</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  unordered_map_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unordered_map_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  unordered_map_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unordered_multimap_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // unordered_set test : 测试 unordered_set, unordered_multiset 的接口与它们 insert 的性能</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  unordered_set_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unordered_set_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  unordered_set_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unordered_multiset_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // string test : 测试 string 的接口和 insert 的性能</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  string_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">string_test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> defined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_MSC_VER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> defined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  _CrtDumpMemoryLeaks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#endif</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // check memory leaks</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>关于宏的两点：</p> <ol><li><p>特殊符号 <code>#</code> 和 <code>##</code></p> <p><code>#</code> ： 预处理时，将<code>#</code>后连接的实参字符串化</p> <p><code>##</code> ：一种分隔连接方式，它的作用是先分隔，然后进行强制连接。在普通的宏定义中，预处理器一般把空格解释成分段标志，对于每一段和前面比较，相同的就被替换。但是这样做的结果是，被替换段之间存在一些空格。如果我们不希望出现这些空格，就可以通过添加一些<code>##</code>来替代空格。</p> <p>例如：</p> <div class="language-cpp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TYPE1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)   type name_##type##_type</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TYPE2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)   type name##_##type##_type</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TYPE1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, c);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // int 　name_int_type; (因为##号将后面分为 name_ 、type 、 _type三组，替换后强制连接)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TYPE2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, d);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // int 　d_int_type;    (因为##号将后面分为 name、_、type 、_type四组，替换后强制连接)</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>宏定义中的<code>do{ }while(0)</code></p> <p>使用do{...}while(0)构造后的宏定义不会受到大括号、分号等的影响，总是会按你期望的方式调用运行。</p></li></ol> <div class="language-CPP vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">CPP</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 测试案例的类名，替换为 test_case_TEST</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TESTCASE_NAME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">testcase_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    testcase_name##_TEST</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用宏定义掩盖复杂的测试样例封装过程，把 TEXT 中的测试案例放到单元测试中</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MYTINYSTL_TEST_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">testcase_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)                        </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TESTCASE_NAME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">testcase_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) : public TestCase {        </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                                                       \\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    TESTCASE_NAME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(testcase_name)(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> case_name)       </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TestCase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(case_name) {};                             </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    virtual</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();                                       </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                                                      \\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TestCase</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> testcase_;                         </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};                                                            </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                                                              \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TestCase</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TESTCASE_NAME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(testcase_name)                  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ::testcase_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UnitTest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RegisterTestCase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TESTCASE_NAME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(testcase_name)(#testcase_name));    </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TESTCASE_NAME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">testcase_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 简单测试的宏定义</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TEST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">testcase_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  MYTINYSTL_TEST_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(testcase_name)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">Run()后边没有写实现，是为了用宏定义将测试用例放入到 Run 的实现里，例如：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">TEST(AddTestDemo)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">EXPECT_EQ(3, Add(1, 2));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">EXPECT_EQ(2, Add(1, 1));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">上述代码将 { EXPECT_EQ(3, Add(1, 2)); EXPECT_EQ(2, Add(1, 1)); } 接到 Run() 的后面</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">*/</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>预处理阶段，上述代码在<code>TEST</code> 处展开后，<code>TEST</code> 后面<code>{...}</code> 的内容将拼接到 <code>Run()</code> 后，成为<code>Run()</code> 的实现。</p> <p><code>MYTINYSTL_TEST_(testcase_name)</code> 展开后声明一个名为 <code>testcase_name_TEST</code> 的类（<code>testcase_name</code> 是形参），13行声明了一个静态指针常量成员，指向一个测试用例，16行对该静态成员进行定义，并将其加入到用例集合中。</p> <h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-label="Permalink to &quot;参考&quot;">​</a></h2> <p>[1] <a href="https://blog.csdn.net/qq_40571533/article/details/102558371?spm=1001.2014.3001.5502" target="_blank" rel="noreferrer">MyTinySTL阅读笔记---概述_xiaoxiao涛的博客-CSDN博客_mytinystl源码分析</a></p> <p>[2] <a href="https://github.com/Alinshans/MyTinySTL" target="_blank" rel="noreferrer">Alinshans/MyTinySTL: Achieve a tiny STL in C++11 (github.com)</a></p> <p>[3] <a href="https://github.com/Alinshans/MyTinySTL/wiki" target="_blank" rel="noreferrer">Home · Alinshans/MyTinySTL Wiki (github.com)</a></p> <p>[4] <a href="https://www.cnblogs.com/Anker/p/3418792.html" target="_blank" rel="noreferrer">C语言宏高级用法 总结 - Rabbit_Dale - 博客园 (cnblogs.com)</a></p>`,52)])])}const b=a(l,[["render",e]]);export{E as __pageData,b as default};
