import{_ as a,o as i,c as n,ag as e}from"./chunks/framework.DEqXEGcv.js";const o=JSON.parse('{"title":"加压测试问题记录","description":"","frontmatter":{},"headers":[],"relativePath":"2 计算机/数据库/eXtremeDB/加压测试问题记录.md","filePath":"2 计算机/数据库/eXtremeDB/加压测试问题记录.md","lastUpdated":1770889489000}'),p={name:"2 计算机/数据库/eXtremeDB/加压测试问题记录.md"};function l(t,s,h,r,k,d){return i(),n("div",null,[...s[0]||(s[0]=[e(`<h1 id="加压测试问题记录" tabindex="-1">加压测试问题记录 <a class="header-anchor" href="#加压测试问题记录" aria-label="Permalink to &quot;加压测试问题记录&quot;">​</a></h1> <h2 id="io-加压断连" tabindex="-1">IO 加压断连 <a class="header-anchor" href="#io-加压断连" aria-label="Permalink to &quot;IO 加压断连&quot;">​</a></h2> <p>问题描述：</p> <p>使用<code>stress</code>命令加压时与测试板连接断开。</p> <div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># stress --vm 2 --vm-bytes 128M</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stress:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [xxxx] dispatching hogs: 0 cpu, 0 io, 0 vm, 0 hdd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Network</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> error:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Software</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> caused</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> connection</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abort</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Session</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stopped</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>原因分析：</p> <ol><li><p><s>eXtremeDB 预先申请的内存过大导致加压后内存超限</s>（排除）</p> <p>尝试减小预设的数据库大小，但是问题仍然存在。eXtremeDB 预先malloc的内存是虚拟内存，只有在使用时才会映射到物理内存上，所以应该与预设的数据库大小无关。</p></li> <li><p>使用<code>top</code>命令查看内存占用量时，发现<code>stress</code>cpu占用率将近100%</p> <p>查找关于<code>stress</code>命令的资料发现<code>stress</code>内存加压的默认方式是不断的申请和释放指定大小的内存，CPU占用率极高，使用以下指令可以使stress任务一直占用内存而不立即释放：</p> <div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stress</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --vm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --vm-bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 128M</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --vm-keep</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 任务一直占用内存不释放</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stress</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --vm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --vm-bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 128M</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --vm-hang</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 任务分配到内存后转入睡眠状态 5 秒，然后释放内存，一直重复执行（分配的内存在5秒后释放掉）</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol> <h2 id="混合加压时加上磁盘加压断连" tabindex="-1">混合加压时加上磁盘加压断连 <a class="header-anchor" href="#混合加压时加上磁盘加压断连" aria-label="Permalink to &quot;混合加压时加上磁盘加压断连&quot;">​</a></h2> <p>命令及输出如下：</p> <div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># stress --cpu 4 --io 4 --hdd 2 --vm 2 --vm-bytes 128M --vm-keep</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stress:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [xxxx] dispatching hogs: 4 cpu, 4 io, 2 vm, 2 hdd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Network</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> error:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Software</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> caused</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> connection</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abort</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Session</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stopped</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>猜测原因：<code>-hdd</code> 不加参数<code>--hdd-bytes</code>默1G，占用过多系统资源。</p>`,19)])])}const F=a(p,[["render",l]]);export{o as __pageData,F as default};
