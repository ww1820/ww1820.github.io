import{_ as i,o as a,c as n,ag as l}from"./chunks/framework.DEqXEGcv.js";const o=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"2 计算机/编程语言/为什么有些类要禁止拷贝与移动，常见的原因有哪些.md","filePath":"2 计算机/编程语言/为什么有些类要禁止拷贝与移动，常见的原因有哪些.md","lastUpdated":1770949611000}'),h={name:"2 计算机/编程语言/为什么有些类要禁止拷贝与移动，常见的原因有哪些.md"};function p(t,s,e,k,r,d){return a(),n("div",null,[...s[0]||(s[0]=[l(`<p>在 C++ 中，禁止类的拷贝和移动操作（通过删除拷贝构造函数、拷贝赋值运算符、移动构造函数和移动赋值运算符）通常是为了满足设计需求或避免潜在问题。以下是常见原因：</p> <hr> <h3 id="_1-资源管理的唯一性" tabindex="-1"><strong>1. 资源管理的唯一性</strong> <a class="header-anchor" href="#_1-资源管理的唯一性" aria-label="Permalink to &quot;**1. 资源管理的唯一性**&quot;">​</a></h3> <ul><li><strong>场景</strong>：类管理独占资源（如文件句柄、网络连接、锁、硬件设备等）。</li> <li><strong>原因</strong>：
<ul><li>拷贝或移动可能导致资源被多个对象共享，引发重复释放或竞争条件。</li> <li>例如，<code>std::unique_ptr</code> 禁止拷贝，因为指针所有权必须唯一。</li></ul></li></ul> <hr> <h3 id="_2-单例模式-singleton" tabindex="-1"><strong>2. 单例模式（Singleton）</strong> <a class="header-anchor" href="#_2-单例模式-singleton" aria-label="Permalink to &quot;**2. 单例模式（Singleton）**&quot;">​</a></h3> <ul><li><strong>场景</strong>：确保全局只有一个实例的类。</li> <li><strong>原因</strong>：
<ul><li>拷贝或移动会破坏单例的唯一性。</li> <li>通常通过删除拷贝和移动操作来强制实现单例。</li></ul></li></ul> <hr> <h3 id="_3-性能优化" tabindex="-1"><strong>3. 性能优化</strong> <a class="header-anchor" href="#_3-性能优化" aria-label="Permalink to &quot;**3. 性能优化**&quot;">​</a></h3> <ul><li><strong>场景</strong>：类的拷贝或移动成本极高（如大型缓存、复杂状态）。</li> <li><strong>原因</strong>：
<ul><li>禁止拷贝/移动可以强制用户显式管理对象生命周期（如通过引用或指针传递）。</li> <li>避免隐式拷贝导致的性能问题。</li></ul></li></ul> <hr> <h3 id="_4-线程安全性" tabindex="-1"><strong>4. 线程安全性</strong> <a class="header-anchor" href="#_4-线程安全性" aria-label="Permalink to &quot;**4. 线程安全性**&quot;">​</a></h3> <ul><li><strong>场景</strong>：类包含共享状态或非线程安全的成员。</li> <li><strong>原因</strong>：
<ul><li>拷贝或移动可能导致多线程环境下状态不一致。</li> <li>例如，一个类内部维护了线程局部存储（TLS），拷贝会破坏 TLS 的语义。</li></ul></li></ul> <hr> <h3 id="_5-不可变对象-immutable-objects" tabindex="-1"><strong>5. 不可变对象（Immutable Objects）</strong> <a class="header-anchor" href="#_5-不可变对象-immutable-objects" aria-label="Permalink to &quot;**5. 不可变对象（Immutable Objects）**&quot;">​</a></h3> <ul><li><strong>场景</strong>：设计为不可变的类（如配置信息、数学常量）。</li> <li><strong>原因</strong>：
<ul><li>禁止拷贝/移动可以强制所有修改通过构造函数完成，确保对象状态始终一致。</li> <li>例如，<code>std::mutex</code> 不可拷贝，因为它的状态与具体线程绑定。</li></ul></li></ul> <hr> <h3 id="_6-接口设计约束" tabindex="-1"><strong>6. 接口设计约束</strong> <a class="header-anchor" href="#_6-接口设计约束" aria-label="Permalink to &quot;**6. 接口设计约束**&quot;">​</a></h3> <ul><li><strong>场景</strong>：抽象基类或接口类。</li> <li><strong>原因</strong>：
<ul><li>禁止拷贝/移动可以强制子类实现自己的语义（如深拷贝）。</li> <li>避免切片问题（slicing problem）。</li></ul></li></ul> <hr> <h3 id="_7-避免逻辑错误" tabindex="-1"><strong>7. 避免逻辑错误</strong> <a class="header-anchor" href="#_7-避免逻辑错误" aria-label="Permalink to &quot;**7. 避免逻辑错误**&quot;">​</a></h3> <ul><li><strong>场景</strong>：类的拷贝或移动无意义或可能导致逻辑错误。</li> <li><strong>原因</strong>：
<ul><li>例如，一个表示“数据库连接”的类，拷贝会导致多个对象共享同一连接，可能引发事务冲突。</li></ul></li></ul> <hr> <h3 id="实现方式" tabindex="-1"><strong>实现方式</strong> <a class="header-anchor" href="#实现方式" aria-label="Permalink to &quot;**实现方式**&quot;">​</a></h3> <p>在 C++ 中，可以通过以下方式禁止拷贝和移动：</p> <div class="language-cpp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NonCopyable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    NonCopyable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ~NonCopyable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 禁止拷贝</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    NonCopyable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NonCopyable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    NonCopyable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> operator</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NonCopyable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 禁止移动（C++11 起）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    NonCopyable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NonCopyable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    NonCopyable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> operator</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NonCopyable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>使用宏定义禁止拷贝与移动的类：</p> <div class="language-cpp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 删除拷贝构造与拷贝赋值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CLAZ_DISABLE_COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">Claz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Claz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Claz</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Claz</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> operator</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Claz</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 删除移动构造与移动赋值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CLAZ_DISABLE_MOVE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">Claz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Claz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Claz</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Claz</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> operator</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Claz</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 删除拷贝/移动构造与拷贝/移动赋值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CLAZ_DISABLE_COPY_MOVE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">Claz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    CLAZ_DISABLE_COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Claz) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    CLAZ_DISABLE_MOVE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Claz)</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><hr> <h3 id="总结" tabindex="-1"><strong>总结</strong> <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;**总结**&quot;">​</a></h3> <p>禁止拷贝和移动的核心目的是：</p> <ol><li><strong>保证资源安全</strong>（唯一性、线程安全）。</li> <li><strong>强制设计约束</strong>（单例、不可变对象）。</li> <li><strong>避免性能损耗或逻辑错误</strong>。</li></ol> <p>在设计类时，应根据具体需求决定是否允许拷贝或移动操作。</p>`,63)])])}const E=i(h,[["render",p]]);export{o as __pageData,E as default};
