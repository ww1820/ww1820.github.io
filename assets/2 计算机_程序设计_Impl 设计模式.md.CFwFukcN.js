import{_ as i,o as a,c as n,ag as l}from"./chunks/framework.DEqXEGcv.js";const o=JSON.parse('{"title":"C++中的 Impl 设计模式介绍","description":"","frontmatter":{},"headers":[],"relativePath":"2 计算机/程序设计/Impl 设计模式.md","filePath":"2 计算机/程序设计/Impl 设计模式.md","lastUpdated":1770949611000}'),p={name:"2 计算机/程序设计/Impl 设计模式.md"};function e(t,s,h,r,k,d){return a(),n("div",null,[...s[0]||(s[0]=[l(`<h1 id="c-中的-impl-设计模式介绍" tabindex="-1">C++中的 Impl 设计模式介绍 <a class="header-anchor" href="#c-中的-impl-设计模式介绍" aria-label="Permalink to &quot;C++中的 Impl 设计模式介绍&quot;">​</a></h1> <p>Impl（Pointer to Implementation，指针指向实现）是 C++中一种经典的接口与实现分离的设计模式，也被称为&quot;编译器防火墙&quot;或&quot;柴郡猫&quot;模式。它的核心思想是通过&quot;指针封装实现细节&quot;，解决头文件依赖、编译效率和二进制兼容等问题。</p> <h2 id="核心原理" tabindex="-1">核心原理 <a class="header-anchor" href="#核心原理" aria-label="Permalink to &quot;核心原理&quot;">​</a></h2> <p>Impl 设计模式将类的私有数据和实现逻辑封装到一个独立的&quot;实现类（Impl）&quot;中，而对外暴露的类（称为&quot;接口类&quot;）仅持有一个指向 Impl 的指针（通常是智能指针）。所有接口方法都通过该指针转发到 Impl 执行。</p> <h2 id="结构分层" tabindex="-1">结构分层 <a class="header-anchor" href="#结构分层" aria-label="Permalink to &quot;结构分层&quot;">​</a></h2> <ol><li><strong>接口类（对外）</strong>：头文件中仅暴露公共接口、前向声明 Impl，不包含任何私有数据</li> <li><strong>实现类（对内）</strong>：仅在. cpp 文件中定义，包含所有私有数据和业务逻辑</li> <li><strong>指针连接</strong>：接口类通过智能指针（std:: unique_ptr 或 std::shared_ptr）持有 Impl 实例</li></ol> <h2 id="实现示例" tabindex="-1">实现示例 <a class="header-anchor" href="#实现示例" aria-label="Permalink to &quot;实现示例&quot;">​</a></h2> <h3 id="头文件-接口类" tabindex="-1">头文件（接口类） <a class="header-anchor" href="#头文件-接口类" aria-label="Permalink to &quot;头文件（接口类）&quot;">​</a></h3> <div class="language-cpp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// MyInterface.h</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#pragma</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> once</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;memory&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    MyInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ~MyInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> doSomething</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 前向声明Impl类</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Impl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 使用智能指针持有Impl实例</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::unique_ptr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Impl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pimpl;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="源文件-实现类" tabindex="-1">源文件（实现类） <a class="header-anchor" href="#源文件-实现类" aria-label="Permalink to &quot;源文件（实现类）&quot;">​</a></h3> <div class="language-cpp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// MyInterface.cpp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;MyInterface.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 实现类定义</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Impl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> doSomethingImpl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 其他私有数据和实现</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 接口类实现</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MyInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MyInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pimpl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make_unique</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Impl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;()) {}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MyInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MyInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">doSomething</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pimpl-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">doSomethingImpl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 实现类的具体实现</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Impl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">doSomethingImpl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 具体实现逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="主要优势" tabindex="-1">主要优势 <a class="header-anchor" href="#主要优势" aria-label="Permalink to &quot;主要优势&quot;">​</a></h2> <ol><li><p><strong>编译防火墙（Compile Firewall）</strong></p> <ul><li>头文件修改不会导致所有包含该头文件的代码重新编译</li> <li>Impl 的修改仅需重新编译接口类的. cpp 文件，无需影响其他模块</li></ul></li> <li><p><strong>接口与实现分离</strong></p> <ul><li>隐藏实现细节，只暴露必要的接口</li> <li>提高代码封装性和可维护性</li></ul></li> <li><p><strong>二进制兼容性</strong></p> <ul><li>实现类的修改不会破坏接口类的二进制接口</li> <li>有助于保持库的向后兼容性</li></ul></li></ol> <h2 id="与相关设计模式的结合" tabindex="-1">与相关设计模式的结合 <a class="header-anchor" href="#与相关设计模式的结合" aria-label="Permalink to &quot;与相关设计模式的结合&quot;">​</a></h2> <p>Impl 模式常与以下设计模式结合使用：</p> <ol><li><strong>与单例模式结合</strong>：实现全局访问点的同时隐藏实现细节</li> <li><strong>与 CRTP（Curiously Recurring Template Pattern）结合</strong>：提供编译时多态的同时隐藏实现</li> <li><strong>与代理模式结合</strong>：通过代理类控制对 Impl 的访问</li></ol> <h2 id="优缺点分析" tabindex="-1">优缺点分析 <a class="header-anchor" href="#优缺点分析" aria-label="Permalink to &quot;优缺点分析&quot;">​</a></h2> <p><strong>优点</strong>：</p> <ul><li>编译时间显著减少</li> <li>代码维护性提高</li> <li>模块间耦合度降低</li> <li>实现细节可以安全地更改而不影响客户端代码</li></ul> <p><strong>缺点</strong>：</p> <ul><li>运行时性能略有影响（指针间接访问）</li> <li>需要额外的内存来存储指针</li> <li>内存管理责任增加（需确保正确管理 Impl 生命周期）</li></ul> <h2 id="最佳实践" tabindex="-1">最佳实践 <a class="header-anchor" href="#最佳实践" aria-label="Permalink to &quot;最佳实践&quot;">​</a></h2> <ol><li>使用 <code>std::unique_ptr</code> 作为 Impl 的持有方式（避免共享所有权）</li> <li>将 Impl 定义在实现文件中，而非头文件</li> <li>为接口类提供默认构造函数和析构函数</li> <li>在需要时，为非抛出交换操作提供专用化支持</li></ol> <h2 id="应用场景" tabindex="-1">应用场景 <a class="header-anchor" href="#应用场景" aria-label="Permalink to &quot;应用场景&quot;">​</a></h2> <p>Impl 模式特别适用于：</p> <ul><li>大型项目中需要减少编译时间</li> <li>需要隐藏实现细节的库开发</li> <li>需要保持二进制兼容性的 API 设计</li> <li>需要提高代码封装性的场景</li></ul> <p>通过 Impl 设计模式，C++开发者可以有效地分离接口与实现，提高代码的可维护性、可扩展性和编译效率，是现代 C++项目中非常实用的设计模式。</p>`,51)])])}const g=i(p,[["render",e]]);export{o as __pageData,g as default};
