import{_ as i,o as a,c as n,ag as p}from"./chunks/framework.DEqXEGcv.js";const o=JSON.parse('{"title":"","description":"","frontmatter":{"tags":["微服务"]},"headers":[],"relativePath":"2 计算机/项目/TARS/tars.md","filePath":"2 计算机/项目/TARS/tars.md","lastUpdated":1770889489000}'),e={name:"2 计算机/项目/TARS/tars.md"};function t(l,s,r,h,k,c){return a(),n("div",null,[...s[0]||(s[0]=[p(`<p>Stat（调用统计）：统计业务服务上报的各种调用信息，比如总流量、平均耗时、超时率等，以便对服务出现异常时进行告警；</p> <p>Property（业务属性）：统计<strong>业务自定义</strong>上报的属性信息，比如内存使用大小、队列大小、cache命中率等，以便对服务出现异常时进行告警；</p> <p>Notify（异常信息）：统计业务上报的各种异常信息，比如服务状态变更信息、访问db失败信息等，以便对服务出现异常时进行告警；</p> <p>考虑到各种故障以及容灾特性，Node只会对满足启动条件的服务进行发送启动命令。</p> <p>这里采用的策略是：</p> <p>1.服务的当前状态处于过渡状态的不允许重启，即处于“Activating”，“Deactivating”，“Destroying”，“Loading”，“Patching”，“BatchPatching”等状态。</p> <p>2.有可能服务通过运维界面停止的，即人为停止该服务，此时服务的“内部工作状态”会被设置为false，在这种情况下，不允许Node监控线程去启动服务。</p> <p>3.有些服务可能确实出现系统性问题，导致无法启动成功。为了防止频繁的去重启这些服务，Node监控程序采用了“服务重启惩罚时间”的策略：即服务每次重启都会被记录重启次数和重启时间点，在X秒内最多重启N次，如果重启超过N次后，服务还是启动失败，则以Y秒的频率去尝试重启服务。</p> <p>目前框架中的默认值是：60秒内最多启动10次，达到10次启动仍失败后,每隔600秒再重试一次。</p> <div class="language-cpp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ServerLimitInfo</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    bEnableCoreLimit;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          //资源属性开关</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    bCloseCore;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                //core属性的状态，屏蔽:true,打开:false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    EM_CoreType eCoreType;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             //服务core的当前屏蔽方式</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     iMaxExcStopCount;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          //最大服务异常停止个数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> iCoreLimitTimeInterval;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //时间间隔内core的限制，单位是分钟</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> iCoreLimitExpiredTime;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     //core关闭的持续时间,单位为分钟</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> iMonitorIntervalMs;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //keepalive监控时间间隔</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     iActivatorMaxCount;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //最大启动次数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     iActivatorTimeInterval;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //时间</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     iActivatorPunishInterval;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //惩罚受限时间间隔</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    bReportLoadInfo;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           //是否上报节点负载信息,默认上报</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div>`,19)])])}const E=i(e,[["render",t]]);export{o as __pageData,E as default};
