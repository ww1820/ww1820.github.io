import{_ as i,o as a,c as n,ag as l}from"./chunks/framework.DEqXEGcv.js";const g=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"3 é—®é¢˜è®°å½•/å•ä¾‹ææ„é¡ºåºçš„éšæ‚£â€‹.md","filePath":"3 é—®é¢˜è®°å½•/å•ä¾‹ææ„é¡ºåºçš„éšæ‚£â€‹.md","lastUpdated":1770889489000}'),p={name:"3 é—®é¢˜è®°å½•/å•ä¾‹ææ„é¡ºåºçš„éšæ‚£â€‹.md"};function t(e,s,h,k,r,d){return a(),n("div",null,[...s[0]||(s[0]=[l(`<p>åœ¨ C++ ä¸­ï¼Œâ€‹<strong>â€‹å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰çš„ææ„é¡ºåºâ€‹</strong>â€‹æ˜¯ä¸€ä¸ªéœ€è¦ç‰¹åˆ«æ³¨æ„çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨å¤šæ–‡ä»¶ã€å…¨å±€å¯¹è±¡æˆ–ä¾èµ–å…¶ä»–å•ä¾‹çš„æƒ…å†µä¸‹ã€‚å¦‚æœææ„é¡ºåºä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´ â€‹<strong>â€‹è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜ï¼ˆuse-after-freeï¼‰â€‹</strong>â€‹ æˆ– â€‹<strong>â€‹èµ„æºæ³„æ¼â€‹</strong>â€‹ã€‚ä»¥ä¸‹æ˜¯å…³é”®é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼š</p> <hr> <h2 id="â€‹â€‹1-é—®é¢˜-å•ä¾‹ææ„é¡ºåºçš„éšæ‚£â€‹â€‹" tabindex="-1">â€‹<strong>â€‹1. é—®é¢˜ï¼šå•ä¾‹ææ„é¡ºåºçš„éšæ‚£â€‹</strong>â€‹ <a class="header-anchor" href="#â€‹â€‹1-é—®é¢˜-å•ä¾‹ææ„é¡ºåºçš„éšæ‚£â€‹â€‹" aria-label="Permalink to &quot;â€‹**â€‹1. é—®é¢˜ï¼šå•ä¾‹ææ„é¡ºåºçš„éšæ‚£â€‹**â€‹&quot;">â€‹</a></h2> <h3 id="â€‹â€‹-1-é™æ€å­˜å‚¨æœŸå¯¹è±¡çš„ææ„é¡ºåºâ€‹â€‹" tabindex="-1">â€‹<strong>â€‹(1) é™æ€å­˜å‚¨æœŸå¯¹è±¡çš„ææ„é¡ºåºâ€‹</strong>â€‹ <a class="header-anchor" href="#â€‹â€‹-1-é™æ€å­˜å‚¨æœŸå¯¹è±¡çš„ææ„é¡ºåºâ€‹â€‹" aria-label="Permalink to &quot;â€‹**â€‹(1) é™æ€å­˜å‚¨æœŸå¯¹è±¡çš„ææ„é¡ºåºâ€‹**â€‹&quot;">â€‹</a></h3> <ul><li>å•ä¾‹é€šå¸¸æ˜¯ â€‹<strong>â€‹å…¨å±€é™æ€å¯¹è±¡â€‹</strong>â€‹ æˆ– â€‹<strong>â€‹å‡½æ•°å±€éƒ¨é™æ€å¯¹è±¡â€‹</strong>â€‹ï¼ˆMeyers&#39; Singletonï¼‰ã€‚</li> <li>C++ æ ‡å‡†è§„å®šï¼šâ€‹<strong>â€‹ä¸åŒç¼–è¯‘å•å…ƒï¼ˆ.cpp æ–‡ä»¶ï¼‰ä¸­çš„å…¨å±€é™æ€å¯¹è±¡çš„ææ„é¡ºåºæ˜¯æœªå®šä¹‰çš„â€‹</strong>â€‹ã€‚</li> <li>å¦‚æœå•ä¾‹ A ä¾èµ–å•ä¾‹ Bï¼Œè€Œ B å…ˆè¢«ææ„ï¼ŒA åœ¨ææ„æ—¶è®¿é—® B ä¼šå¯¼è‡´ â€‹<strong>â€‹æœªå®šä¹‰è¡Œä¸ºï¼ˆUBï¼‰â€‹</strong>â€‹ã€‚</li></ul> <h3 id="â€‹â€‹-2-å…¸å‹å´©æºƒåœºæ™¯â€‹â€‹" tabindex="-1">â€‹<strong>â€‹(2) å…¸å‹å´©æºƒåœºæ™¯â€‹</strong>â€‹ <a class="header-anchor" href="#â€‹â€‹-2-å…¸å‹å´©æºƒåœºæ™¯â€‹â€‹" aria-label="Permalink to &quot;â€‹**â€‹(2) å…¸å‹å´©æºƒåœºæ™¯â€‹**â€‹&quot;">â€‹</a></h3> <div class="language-cpp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// SingletonA.hpp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SingletonA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SingletonA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SingletonA instance;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Meyers&#39; Singleton</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> instance;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ~SingletonA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ä¾èµ– SingletonB</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        SingletonB</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SingletonA destroyed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// SingletonB.hpp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SingletonB</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SingletonB</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SingletonB instance;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> instance;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">string</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* ... */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ~SingletonB</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* ... */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ul><li>å¦‚æœ <code>SingletonB</code> å…ˆææ„ï¼Œ<code>SingletonA</code> ææ„æ—¶ä¼šè°ƒç”¨å·²é”€æ¯çš„ <code>SingletonB::get()</code>ï¼Œå¯¼è‡´å´©æºƒã€‚</li></ul> <hr> <h2 id="â€‹â€‹2-è§£å†³æ–¹æ¡ˆâ€‹â€‹" tabindex="-1">â€‹<strong>â€‹2. è§£å†³æ–¹æ¡ˆâ€‹</strong>â€‹ <a class="header-anchor" href="#â€‹â€‹2-è§£å†³æ–¹æ¡ˆâ€‹â€‹" aria-label="Permalink to &quot;â€‹**â€‹2. è§£å†³æ–¹æ¡ˆâ€‹**â€‹&quot;">â€‹</a></h2> <h3 id="â€‹â€‹-1-ä½¿ç”¨-std-shared-ptr-std-weak-ptr-ç®¡ç†ç”Ÿå‘½å‘¨æœŸâ€‹â€‹" tabindex="-1">â€‹<strong>â€‹(1) ä½¿ç”¨ <code>std::shared_ptr</code> + <code>std::weak_ptr</code> ç®¡ç†ç”Ÿå‘½å‘¨æœŸâ€‹</strong>â€‹ <a class="header-anchor" href="#â€‹â€‹-1-ä½¿ç”¨-std-shared-ptr-std-weak-ptr-ç®¡ç†ç”Ÿå‘½å‘¨æœŸâ€‹â€‹" aria-label="Permalink to &quot;â€‹**â€‹(1) ä½¿ç”¨ \`std::shared_ptr\` + \`std::weak_ptr\` ç®¡ç†ç”Ÿå‘½å‘¨æœŸâ€‹**â€‹&quot;">â€‹</a></h3> <ul><li>å°†å•ä¾‹æ”¹ä¸º <code>shared_ptr</code>ï¼Œå¹¶ç”¨ <code>weak_ptr</code> å®‰å…¨è®¿é—®ã€‚</li> <li>ææ„æ—¶æ‰‹åŠ¨æ§åˆ¶é¡ºåºã€‚</li></ul> <div class="language-cpp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Singleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">shared_ptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Singleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::weak_ptr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Singleton</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weak;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        auto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weak.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">instance) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">shared_ptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Singleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Singleton);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            weak </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> instance;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> instance;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Singleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ~Singleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* ææ„é€»è¾‘ */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="â€‹â€‹-2-ä¾èµ–æ³¨å…¥-æ‰‹åŠ¨æ§åˆ¶ææ„é¡ºåº-â€‹â€‹" tabindex="-1">â€‹<strong>â€‹(2) ä¾èµ–æ³¨å…¥ï¼ˆæ‰‹åŠ¨æ§åˆ¶ææ„é¡ºåºï¼‰â€‹</strong>â€‹ <a class="header-anchor" href="#â€‹â€‹-2-ä¾èµ–æ³¨å…¥-æ‰‹åŠ¨æ§åˆ¶ææ„é¡ºåº-â€‹â€‹" aria-label="Permalink to &quot;â€‹**â€‹(2) ä¾èµ–æ³¨å…¥ï¼ˆæ‰‹åŠ¨æ§åˆ¶ææ„é¡ºåºï¼‰â€‹**â€‹&quot;">â€‹</a></h3> <ul><li>åœ¨ç¨‹åºé€€å‡ºå‰ â€‹<strong>â€‹æ˜¾å¼é‡Šæ”¾å•ä¾‹â€‹</strong>â€‹ï¼Œé¿å…ä¾èµ–æœªå®šä¹‰çš„ææ„é¡ºåºã€‚</li> <li>é€‚ç”¨äºéœ€è¦ä¸¥æ ¼æ§åˆ¶èµ„æºé‡Šæ”¾çš„åœºæ™¯ã€‚</li></ul> <div class="language-cpp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Singleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Singleton</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Singleton instance;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> instance;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ‰‹åŠ¨ææ„</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">~Singleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Singleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ~Singleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* ... */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åœ¨ main() é€€å‡ºå‰è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Singleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ç¡®ä¿ææ„é¡ºåº</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="â€‹â€‹-3-ä½¿ç”¨-phoenix-singleton-å¤æ´»æ¨¡å¼-â€‹â€‹" tabindex="-1">â€‹<strong>â€‹(3) ä½¿ç”¨ &quot;Phoenix Singleton&quot;ï¼ˆå¤æ´»æ¨¡å¼ï¼‰â€‹</strong>â€‹ <a class="header-anchor" href="#â€‹â€‹-3-ä½¿ç”¨-phoenix-singleton-å¤æ´»æ¨¡å¼-â€‹â€‹" aria-label="Permalink to &quot;â€‹**â€‹(3) ä½¿ç”¨ &quot;Phoenix Singleton&quot;ï¼ˆå¤æ´»æ¨¡å¼ï¼‰â€‹**â€‹&quot;">â€‹</a></h3> <ul><li>å…è®¸å•ä¾‹åœ¨è¢«ææ„åé‡æ–°åˆ›å»ºï¼ˆé€‚ç”¨äºæ—¥å¿—ç­‰åœºæ™¯ï¼‰ã€‚</li> <li>é€šè¿‡ <code>atexit</code> æ³¨å†Œææ„å‡½æ•°ã€‚</li></ul> <div class="language-cpp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PhoenixSingleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PhoenixSingleton</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PhoenixSingleton</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nullptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">instance) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PhoenixSingleton;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">atexit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([] { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> instance; instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nullptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">instance;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    PhoenixSingleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ~PhoenixSingleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* ... */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="â€‹â€‹-4-é¿å…ææ„ä¾èµ–â€‹â€‹" tabindex="-1">â€‹<strong>â€‹(4) é¿å…ææ„ä¾èµ–â€‹</strong>â€‹ <a class="header-anchor" href="#â€‹â€‹-4-é¿å…ææ„ä¾èµ–â€‹â€‹" aria-label="Permalink to &quot;â€‹**â€‹(4) é¿å…ææ„ä¾èµ–â€‹**â€‹&quot;">â€‹</a></h3> <ul><li>å¦‚æœå•ä¾‹ææ„æ—¶ä¸ä¾èµ–å…¶ä»–å•ä¾‹ï¼Œç›´æ¥ç”¨ â€‹<strong>â€‹Meyers&#39; Singletonâ€‹</strong>â€‹ï¼ˆæœ€å®‰å…¨ï¼‰ã€‚</li></ul> <div class="language-cpp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SafeSingleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SafeSingleton</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SafeSingleton instance;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // C++11 ä¿è¯çº¿ç¨‹å®‰å…¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> instance;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    SafeSingleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ~SafeSingleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* ä¸ä¾èµ–å…¶ä»–å•ä¾‹ */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre> <div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><hr> <h2 id="â€‹â€‹3-æœ€ä½³å®è·µâ€‹â€‹" tabindex="-1">â€‹<strong>â€‹3. æœ€ä½³å®è·µâ€‹</strong>â€‹ <a class="header-anchor" href="#â€‹â€‹3-æœ€ä½³å®è·µâ€‹â€‹" aria-label="Permalink to &quot;â€‹**â€‹3. æœ€ä½³å®è·µâ€‹**â€‹&quot;">â€‹</a></h2> <table tabindex="0"><thead><tr><th>åœºæ™¯</th> <th>æ–¹æ¡ˆ</th> <th>é€‚ç”¨æ€§</th></tr></thead> <tbody><tr><td>â€‹<strong>â€‹æ— ä¾èµ–çš„å•ä¾‹â€‹</strong>â€‹</td> <td>Meyers&#39; Singleton</td> <td>âœ… æ¨è</td></tr> <tr><td>â€‹<strong>â€‹ä¾èµ–å…¶ä»–å•ä¾‹â€‹</strong>â€‹</td> <td><code>shared_ptr</code> + <code>weak_ptr</code></td> <td>âš ï¸ éœ€æ‰‹åŠ¨ç®¡ç†</td></tr> <tr><td>â€‹<strong>â€‹ä¸¥æ ¼ææ„é¡ºåºâ€‹</strong>â€‹</td> <td>æ‰‹åŠ¨è°ƒç”¨ <code>destroy()</code></td> <td>ğŸ› ï¸ å¤æ‚ä½†å¯æ§</td></tr> <tr><td>â€‹<strong>â€‹å…è®¸å¤æ´»â€‹</strong>â€‹</td> <td>Phoenix Singleton</td> <td>ğŸ”„ ç‰¹æ®Šåœºæ™¯ï¼ˆå¦‚æ—¥å¿—ï¼‰</td></tr></tbody></table> <hr> <h2 id="â€‹â€‹4-å…³é”®ç‚¹æ€»ç»“â€‹â€‹" tabindex="-1">â€‹<strong>â€‹4. å…³é”®ç‚¹æ€»ç»“â€‹</strong>â€‹ <a class="header-anchor" href="#â€‹â€‹4-å…³é”®ç‚¹æ€»ç»“â€‹â€‹" aria-label="Permalink to &quot;â€‹**â€‹4. å…³é”®ç‚¹æ€»ç»“â€‹**â€‹&quot;">â€‹</a></h2> <ol><li>â€‹<strong>â€‹Meyers&#39; Singletonâ€‹</strong>â€‹ æ˜¯é»˜è®¤é€‰æ‹©ï¼ˆçº¿ç¨‹å®‰å…¨ä¸”ç®€å•ï¼‰ï¼Œä½†ææ„é¡ºåºä¸å¯æ§ã€‚</li> <li>å¦‚æœå•ä¾‹ä¹‹é—´æœ‰ä¾èµ–ï¼Œç”¨ <code>shared_ptr</code> æˆ–æ‰‹åŠ¨æ§åˆ¶ææ„ã€‚</li> <li>â€‹<strong>â€‹é¿å…åœ¨ææ„å‡½æ•°ä¸­è°ƒç”¨å…¶ä»–å•ä¾‹â€‹</strong>â€‹ï¼ˆè®¾è®¡ä¸Šè§£è€¦ï¼‰ã€‚</li> <li>åœ¨ç¨‹åºé€€å‡ºå‰æ˜¾å¼é‡Šæ”¾èµ„æºï¼ˆå¦‚æ•°æ®åº“è¿æ¥ã€æ–‡ä»¶å¥æŸ„ï¼‰ã€‚</li></ol> <p>å¦‚æœå•ä¾‹ææ„é—®é¢˜å¯¼è‡´å´©æºƒï¼Œå¯ä»¥ç”¨ â€‹<strong>â€‹Valgrindâ€‹</strong>â€‹ æˆ– â€‹<strong>â€‹AddressSanitizerâ€‹</strong>â€‹ æ£€æµ‹éæ³•è®¿é—®ã€‚</p>`,52)])])}const c=i(p,[["render",t]]);export{g as __pageData,c as default};
