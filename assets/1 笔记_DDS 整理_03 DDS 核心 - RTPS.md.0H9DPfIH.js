import{_ as i,o as l,c as t,ag as e}from"./chunks/framework.DEqXEGcv.js";const h=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"1 笔记/DDS 整理/03 DDS 核心 - RTPS.md","filePath":"1 笔记/DDS 整理/03 DDS 核心 - RTPS.md","lastUpdated":1770889489000}'),r={name:"1 笔记/DDS 整理/03 DDS 核心 - RTPS.md"};function o(d,a,n,D,s,P){return l(),t("div",null,[...a[0]||(a[0]=[e(`<p><img src="https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/20260113194129737.png" alt="image.png" loading="lazy"> 1. 概述</p> <h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to &quot;概述&quot;">​</a></h2> <p>RTPS规范，全称为实时发布/订阅协议DDS互操作规范（The Real-Time Publish-Subscribe Protocol (RTPS) DDS Interoperability Wire Protocol Specification），RTPS在某些场景下也被叫做DDSI-RTPS。该协议产生的原因在于：</p> <ul><li>DDS接口（DCPS）规范；</li> <li>不同厂家实现DDS接口规范形成不同的DDS产品；</li> <li>使用不同DDS产品的系统需要集成，即对不同厂家的DDS互操作、互联互通提出了新的需求；</li> <li>提出RTPS规范来定义DDS底层的报文格式、行为等内容。</li></ul> <p>RTPS规范的内容参见下图，主要分为4个模块：</p> <ul><li>结构模块，定义概念和数据结构；</li> <li>报文模块，定义报文格式；</li> <li>行为模块，定义不同配置下传输的行为，即什么情况下发送什么报文，如何响应接收到的报文；</li> <li>发现模块，综合使用以上三个模块，定义简单发现协议，用于通信实体之间的自动发现与匹配。</li></ul> <h2 id="结构模块" tabindex="-1">结构模块 <a class="header-anchor" href="#结构模块" aria-label="Permalink to &quot;结构模块&quot;">​</a></h2> <p>描述了作为通信参与者的RTPS实体的结构，如下图所示，RTPS实体是被应用程序可见的DDS实体相互通信而使用的协议级端点。</p> <p><img src="https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/20260210143508060.png" alt="image.png" loading="lazy"></p> <table tabindex="0"><thead><tr><th>概念定义</th> <th>说明</th></tr></thead> <tbody><tr><td>Entity</td> <td>实体，包括：参与者以及通信实体（写者、读者）的共用属性，包括：唯一标识；</td></tr> <tr><td>Participant</td> <td>参与者，作为通信实体（写者、读者）的父实体，存储协议版本、供应商 ID 以及默认的地址信息；</td></tr> <tr><td>Endpoint</td> <td>通信实体，作为写者以及读者的父类抽象，存储两端共有的信息，包括使用的通信地址、可靠性等级一级主题等级；</td></tr> <tr><td>Writer</td> <td>写者，用于发送数据，每个写者关联一个 HistoryCache，用于维护发送的数据，并提供接口发送数据；</td></tr> <tr><td>Reader</td> <td>读者，用于接收数据，每个读者关联一个 HistoryCache，用于维护接收到的数据列表；</td></tr> <tr><td>HistoryCache</td> <td>历史数据缓存队列，提供增、删、查的功能，队列中的元素为 CacheChange；</td></tr> <tr><td>CacheChange</td> <td>描述一个样本数据，包括：发送方标识、序列号、所属数据实例以及负载。</td></tr></tbody></table> <h2 id="报文模块" tabindex="-1">报文模块 <a class="header-anchor" href="#报文模块" aria-label="Permalink to &quot;报文模块&quot;">​</a></h2> <p>Messages模块描述了在RTPS Writer端点和RTPS Reader端点之间交换的消息的总体结构和逻辑内容。</p> <p>报文模块的总体结构如下所示：</p> <ul><li>Message，RTPS 消息，包含一个消息头（Header）以及 1 个到多个子消息（SubMessage）；</li> <li>Header，RTPS 消息头；</li> <li>SubMessage，RTPS 子消息，作为不同子消息的抽象结构，包括一个子消息头（SubmessageHeader）以及每种不同子消息包含不同的一个到多个子消息元素（SubmessageElement），子消息根据功能上的不同可以分为三类；
<ul><li>可靠型，包括：Heartbeat、AckNack、NackFrag；</li> <li>信息型，包括：InfoDestination、InfoTimeStamp、InfoReply 以及 InfoSource；</li> <li>数据型，包括：Data、Gap、DataFrag；</li></ul></li></ul> <h2 id="行为模块" tabindex="-1">行为模块 <a class="header-anchor" href="#行为模块" aria-label="Permalink to &quot;行为模块&quot;">​</a></h2> <p>行为模块进一步定义了 Writer/Reader 的接口及其行为，<strong>主流开源DDS都基于RTPS协议进行实施，Fast DDS支持直接调用RTPS接口，embeddedRTPS 专注嵌入式场景下的RTPS协议实现，可以“纯RTPS”运行。</strong> 行为模块的几种典型的行为：</p> <ul><li><p>StatelessWriter 对应 BEST-EFFORT 类型的数据写者；</p> <ul><li>IDLE状态，匹配新的远程数据读者后进入IDLE状态；</li> <li>PUSHING状态，当有未发送的样本数据时，进入该状态，在该状态下循环发送未发送的样本数据，直到发送完成后进入IDLE状态，仅涉及到DATA以及GAP两类子消息；
<img src="https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/20260210150517700.png" alt="image.png" loading="lazy"></li></ul></li> <li><p>StatelessReader 对应 BEST-EFFORT 类型的数据读者；</p></li> <li><p>StatefulWriter 对应 RELIABLE 类型的数据写者；</p></li> <li><p>StatefulReader 对应 RELIABLE 类型的数据读者；</p></li></ul> <h2 id="发现模块" tabindex="-1">发现模块 <a class="header-anchor" href="#发现模块" aria-label="Permalink to &quot;发现模块&quot;">​</a></h2> <p>发现模块是DDS“纯分布式架构”的基础，每个应用上的DDS实体能够通过纯分布式的方式获取到系统内其他DDS实体的信息，并根据这些信息进行基于主题的按需分发。发现模块定义了两个协议：<strong>参与者发现协议（PDP）</strong> 和 <strong>端点发现协议（EDP）</strong>。</p> <ol><li>参与者发现阶段（PDP）：发现网络中其他 DDS 参与者</li> <li>端点发现阶段（EDP）：在已发现的参与者之间，发现彼此拥有的、可能匹配的 DataWriter 和 DataReader</li></ol> <h3 id="_1-参与者发现协议-pdp" tabindex="-1">1. 参与者发现协议（PDP） <a class="header-anchor" href="#_1-参与者发现协议-pdp" aria-label="Permalink to &quot;1. 参与者发现协议（PDP）&quot;">​</a></h3> <h4 id="核心功能" tabindex="-1">核心功能 <a class="header-anchor" href="#核心功能" aria-label="Permalink to &quot;核心功能&quot;">​</a></h4> <ul><li>创建内置的参与者发现端点（SPDP Writer/Reader）</li> <li>周期性广播本地参与者信息</li> <li>接收并处理远程参与者信息</li> <li>维护参与者代理数据（ParticipantProxyData）</li> <li>触发端点发现过程</li></ul> <h4 id="工作流程" tabindex="-1">工作流程 <a class="header-anchor" href="#工作流程" aria-label="Permalink to &quot;工作流程&quot;">​</a></h4> <ol><li>启动阶段：每个 DomainParticipant 启动时，创建一对内置端点（SPDP Writer 和 Reader）</li> <li>广播机制：周期性（默认 3 秒）在预定义的多播地址和端口上发送 SPDPdiscoveredParticipantData 消息</li> <li>消息内容：包含自身 Participant 的 GUID、QoS、定位信息（Locator - IP/Port）等</li> <li>接收与处理：接收其他 Participant 的 SPDP 消息，更新参与者代理数据</li> <li>连接建立：收到新 Participant 公告后，尝试建立与对方 Participant 的通信通道</li> <li>离开检测：通过停止接收公告或收到明确的 dispose 消息检测 Participant 离开</li></ol> <h4 id="发现模式" tabindex="-1">发现模式 <a class="header-anchor" href="#发现模式" aria-label="Permalink to &quot;发现模式&quot;">​</a></h4> <ul><li>多播发现：节点加入预定义多播组，无需预知其他节点地址，适用于局域网</li> <li>单播发现：节点需预先配置对端地址，通过点对点通信交换信息，适用于广域网或跨子网场景</li></ul> <h3 id="_2-端点发现协议-edp" tabindex="-1">2. 端点发现协议（EDP） <a class="header-anchor" href="#_2-端点发现协议-edp" aria-label="Permalink to &quot;2. 端点发现协议（EDP）&quot;">​</a></h3> <h4 id="核心功能-1" tabindex="-1">核心功能 <a class="header-anchor" href="#核心功能-1" aria-label="Permalink to &quot;核心功能&quot;">​</a></h4> <ul><li>交换 DataWriter 和 DataReader 的信息</li> <li>匹配可能通信的端点</li> <li>确认匹配成功，建立数据传输通道</li></ul> <h4 id="工作流程-1" tabindex="-1">工作流程 <a class="header-anchor" href="#工作流程-1" aria-label="Permalink to &quot;工作流程&quot;">​</a></h4> <ol><li>信息交换：通过 PDP 建立的通信信道，共享 DataWriter 和 DataReader 的信息</li> <li>匹配条件：主题（Topic）和数据类型必须一致</li> <li>确认机制：通过 heartbeat、acknack 等消息确认数据样本
<ul><li>例如：B 的 SEDPbuiltinSubscriptionWriter 发送 heartbeat 给 A 的 SEDPbuiltinSubscriptionReader</li> <li>A 收到后，若发现缺少样本，会发送 acknack 告知丢失的样本</li> <li>B 发送缺失的样本，更新 heartbeat</li></ul></li> <li>匹配完成：当双方确认数据一致后，DataWriter 和 DataReader 可以开始发送/接收用户数据</li></ol> <h3 id="_3-其他-dds-实现的发现机制" tabindex="-1">3. 其他 DDS 实现的发现机制 <a class="header-anchor" href="#_3-其他-dds-实现的发现机制" aria-label="Permalink to &quot;3. 其他 DDS 实现的发现机制&quot;">​</a></h3> <p>Fast DDS 提供了多种发现机制，以适应不同应用场景：</p> <ol><li><p>简单发现（Simple Discovery）</p> <ul><li>默认机制：支持 PDP 和 EDP 的 RTPS 标准</li> <li>兼容性：提供与任何其他 DDS 和 RTPS 实现的兼容性</li> <li>工作方式：使用 SPDP 和 SEDP 协议自动完成发现过程</li></ul></li> <li><p>静态发现（Static Discovery）</p> <ul><li>特点：跳过 EDP 阶段，无需自动发现</li> <li>实现：通过 XML 文件预先配置对端信息</li></ul></li> <li><p>发现服务器（Discovery Server）</p> <ul><li>架构：集中式发现体系结构</li> <li>工作方式：DomainParticipant（称为服务器）充当元流量发现的集线器</li> <li>优势：适用于大规模分布式系统，减少网络广播流量</li></ul></li> <li><p>手动发现（Manual Discovery）</p> <ul><li>特点：禁用 PDP</li> <li>工作方式：用户使用外部元信息信道手动匹配和取消匹配 RTPS 实体</li> <li>适用场景：特殊网络环境或需要高度定制化的系统</li></ul></li></ol>`,69)])])}const p=i(r,[["render",o]]);export{h as __pageData,p as default};
