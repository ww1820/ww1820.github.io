<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/blog.png"><link rel="icon" href="/img/blog.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="AWei"><meta name="keywords" content=""><meta name="description" content="Linux 系统编程入门gcc 编译命令1234567891011gcc [FileName] [-o ProgramName]# 常用编译选项[-o] 目标文件名[-E] 预处理，生成预处理后的代码，不编译[-S] 编译，生成汇编代码，不汇编[-c] 汇编，生成目标代码，但是不进行链接[-I directory] 指定 include 包含文件的搜索目录[-g] 在编译的时候，生成调试信息，该程"><meta property="og:type" content="article"><meta property="og:title" content="Linux 系统编程入门"><meta property="og:url" content="https://ww1820.github.io/posts/bb4cd573/index.html"><meta property="og:site_name" content="AWei&#39;s Blog"><meta property="og:description" content="Linux 系统编程入门gcc 编译命令1234567891011gcc [FileName] [-o ProgramName]# 常用编译选项[-o] 目标文件名[-E] 预处理，生成预处理后的代码，不编译[-S] 编译，生成汇编代码，不汇编[-c] 汇编，生成目标代码，但是不进行链接[-I directory] 指定 include 包含文件的搜索目录[-g] 在编译的时候，生成调试信息，该程"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/202208120301129.png"><meta property="og:image" content="https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/202208120308467.png"><meta property="og:image" content="https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/202208120322763.png"><meta property="og:image" content="https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/202208121756971.png"><meta property="og:image" content="https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/202208121800438.png"><meta property="og:image" content="https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/202208121800966.png"><meta property="og:image" content="https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/202208121836144.png"><meta property="og:image" content="https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/202208121841823.png"><meta property="article:published_time" content="2022-08-14T14:26:34.000Z"><meta property="article:modified_time" content="2022-08-14T14:31:57.348Z"><meta property="article:author" content="AWei"><meta property="article:tag" content="C++"><meta property="article:tag" content="Linux"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/202208120301129.png"><meta name="referrer" content="no-referrer-when-downgrade"><title>Linux 系统编程入门 | AWei&#39;s Blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var dntVal,CONFIG={hostname:"ww1820.github.io",root:"/",version:"1.9.2",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"};CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.2.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>AWei&#39;s Blog</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="Linux 系统编程入门"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-08-14 22:26" pubdate>2022年8月14日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 16k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 138 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">Linux 系统编程入门</h1><div class="markdown-body"><h1 id="Linux-系统编程入门"><a href="#Linux-系统编程入门" class="headerlink" title="Linux 系统编程入门"></a>Linux 系统编程入门</h1><h2 id="gcc-编译命令"><a href="#gcc-编译命令" class="headerlink" title="gcc 编译命令"></a>gcc 编译命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">gcc [FileName] [-o ProgramName]<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">常用编译选项</span><br>[-o] 目标文件名<br>[-E] 预处理，生成预处理后的代码，不编译<br>[-S] 编译，生成汇编代码，不汇编<br>[-c] 汇编，生成目标代码，但是不进行链接<br>[-I directory] 指定 include 包含文件的搜索目录<br>[-g] 在编译的时候，生成调试信息，该程序可以被调试器调试<br>[-D] 编译的时候定义一个宏<br>[-l] 链接的库<br></code></pre></td></tr></table></figure><p>g++ 在编译的阶段调用 gcc，但是 gcc 不能自动和 c++ 程序使用的库链接，除非添加编译选项 <code>gcc -lstdc++</code>。</p><h2 id="静态库和动态库"><a href="#静态库和动态库" class="headerlink" title="静态库和动态库"></a>静态库和动态库</h2><h3 id="静态库的制作"><a href="#静态库的制作" class="headerlink" title="静态库的制作"></a>静态库的制作</h3><ol><li><p>命名规则：</p><ol><li>Linux：libxxx.a</li><li>Windows：libxxx.lib</li></ol></li><li><p>静态库的制作</p><ol><li><p>gcc 编译生成 -o 汇编文件</p><p><code>gcc -c a.c b.c</code></p></li><li><p>对汇编文件打包，创建静态库</p><p><code>ar rcs libxxx.a a.o b.o</code></p></li></ol></li></ol><h3 id="静态库的使用"><a href="#静态库的使用" class="headerlink" title="静态库的使用"></a>静态库的使用</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">gcc FileName -l xxx<br></code></pre></td></tr></table></figure><p><code>xxx</code> 为 库名称，而非库文件名称</p><h3 id="动态库的制作"><a href="#动态库的制作" class="headerlink" title="动态库的制作"></a>动态库的制作</h3><ol><li><p>命名规则：</p><ol><li>Linux：libxxx.so</li><li>Windows：libxxx.dll</li></ol></li><li><p>动态库的制作</p><ol><li><p>gcc 编译生成 -o 汇编文件</p><p><code>gcc -c -fpic/-fPIC a.c b.c</code></p></li><li><p>gcc 制作动态库</p><p><code>gcc -shared *.o -o libxxx.so</code></p></li></ol></li></ol><h3 id="动态库的使用"><a href="#动态库的使用" class="headerlink" title="动态库的使用"></a>动态库的使用</h3><ol><li><p>程序运行时动态库加载失败的原因：</p><p>系统加载可执行代码的时候，除了需要知道所依赖的动态库的名称，还需要知到其绝对路径，此时需要系统的动态载入器来获取其绝对路径。</p></li><li><p>解决方法：</p><ol><li><p>添加环境变量，只在当前终端生效（临时）</p><p><code>export LD_LIBRARY_PATH = $LD_LIBRARY_PATH:libso_path</code></p></li><li><p>添加环境变量，在<code>~/.bashrc</code>中添加（用户级别）</p><p><code>export LD_LIBRARY_PATH = $LD_LIBRARY_PATH:libso_path</code></p><p>使环境变量生效</p><p><code>source ~/.bashrc</code> 或者 <code>，~/.bashrc</code></p></li><li><p>添加环境变量，在<code>/etc/profile</code>中添加（系统级别）</p><p><code>export LD_LIBRARY_PATH = $LD_LIBRARY_PATH:libso_path</code></p><p>使环境变量生效</p><p><code>source /etc/profile</code> 或者 <code>，/etc/profile</code></p></li><li><p>修改 <code>/etc/ld.so.cache</code>，二进制文件，不能直接修改，通过 <code>/etc/ld.so.conf</code> 修改，直接添加<code>libso_path</code>，<code>ldconfig</code> 使修改生效。</p></li><li><p>将动态库文件放在 <code>/lib/</code> 或者 <code>/usr/lib/</code> 目录下（不建议），可能会替换同名的系统库文件。</p></li></ol></li></ol><h3 id="静态库-vs-动态库"><a href="#静态库-vs-动态库" class="headerlink" title="静态库 vs. 动态库"></a>静态库 vs. 动态库</h3><ol><li><p>静态库</p><ul><li><p>优点：</p><p>a. 加载速度快</p><p>b. 发布程序无需提供静态库，移植方便</p></li><li><p>缺点：</p><p>a. 消耗系统资源，浪费内存</p><p>b. 更新、部署、发布麻烦</p></li></ul></li><li><p>动态库</p><ul><li><p>优点：</p><p>a. 可以实现进程间的资源共享</p><p>b. 更新、部署、发布简单</p><p>c. 可以控制核实加载动态库</p></li><li><p>缺点：</p><p>a. 加载速度比静态库慢</p><p>b. 发布程序是需要提供依赖的动态库</p></li></ul></li></ol><h2 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h2><h3 id="什么是-Makefile"><a href="#什么是-Makefile" class="headerlink" title="什么是 Makefile"></a>什么是 Makefile</h3><ul><li>工程的源文件根据类型、功能、模块分别放在不同的目录中，Makefile 文件定义了以系列规则来指定哪些文件先编译，哪些文件后编译，哪些文件需要重新编译，甚至更复杂的功能。</li><li>Makefile 带来的好处：“自动化编译”，make 是解释 Makefile 的命令工具。</li></ul><h3 id="Makefile-文件命名和规则"><a href="#Makefile-文件命名和规则" class="headerlink" title="Makefile 文件命名和规则"></a>Makefile 文件命名和规则</h3><ol><li><p>文件命名：</p><p>Makefile 或者 makefile</p></li><li><p>规则：</p></li></ol><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs makefile">目标 ... : 依赖...<br>    命令 (shell 命令)<br>    ...<br><br><span class="hljs-section">目标: 最终要生成的文件 (伪目标除外)</span><br><span class="hljs-section">依赖: 生成目标所需要的文件或是目标</span><br><span class="hljs-section">命令: 通过执行命令对依赖操作生成目标 (前有缩进)</span><br><br>Makefile 文件里的其他规则一般是为第一条规则服务的. <br></code></pre></td></tr></table></figure><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># 1</span><br><span class="hljs-section">app:sub.c add.c mult.c div.c main.c</span><br>    gcc sub.c add.c mult.c div.c main.c -o app<br>    <br><span class="hljs-comment"># 2</span><br><span class="hljs-section">app:sub.o add.o mult.o div.o main.o</span><br>    gcc sub.o add.o mult.o div.o main.o -o app<br><br><span class="hljs-section">sub.o:sub.c</span><br>    gcc -c sub.c -o sub.o<br><br><span class="hljs-section">add.o:add.c</span><br>    gcc -c add.c -o add.o<br><br><span class="hljs-section">mult.o:mult.c</span><br>    gcc -c mult.c -o mult.o<br><br><span class="hljs-section">div.o:div.c</span><br>    gcc -c div.c -o div.o<br><br><span class="hljs-section">main.o:main.c</span><br>    gcc -c main.c -o main.o<br>    <br><span class="hljs-comment"># 3</span><br><span class="hljs-comment">#定义变量</span><br>src=sub.o add.o mult.o div.o main.o<br>target=app<br><span class="hljs-variable">$(target)</span>:<span class="hljs-variable">$(src)</span><br>    <span class="hljs-variable">$(CC)</span> <span class="hljs-variable">$(src)</span> -o <span class="hljs-variable">$(target)</span><br><br><span class="hljs-section">sub.o:sub.c</span><br>    gcc -c sub.c -o sub.o<br><br><span class="hljs-section">add.o:add.c</span><br>    gcc -c add.c -o add.o<br><br><span class="hljs-section">mult.o:mult.c</span><br>    gcc -c mult.c -o mult.o<br><br><span class="hljs-section">div.o:div.c</span><br>    gcc -c div.c -o div.o<br><br><span class="hljs-section">main.o:main.c</span><br>    gcc -c main.c -o main.o<br>    <br><span class="hljs-comment"># 4</span><br><span class="hljs-comment">#定义变量</span><br>src=sub.o add.o mult.o div.o main.o<br>target=app<br><span class="hljs-variable">$(target)</span>:<span class="hljs-variable">$(src)</span><br>    <span class="hljs-variable">$(CC)</span> <span class="hljs-variable">$(src)</span> -o <span class="hljs-variable">$(target)</span><br><br><span class="hljs-section">%.o:%.c</span><br>    <span class="hljs-variable">$(CC)</span> -c <span class="hljs-variable">$&lt;</span> -o <span class="hljs-variable">$@</span><br>    <br><span class="hljs-comment"># 5</span><br><span class="hljs-comment">#定义变量</span><br><span class="hljs-comment"># add.c sub.c main.c mult.c div.c</span><br>src=<span class="hljs-variable">$(<span class="hljs-built_in">wildcard</span> ./*.c)</span><br>objs=<span class="hljs-variable">$(<span class="hljs-built_in">patsubst</span> %.c, %.o, <span class="hljs-variable">$(src)</span>)</span><br>target=app<br><span class="hljs-variable">$(target)</span>:<span class="hljs-variable">$(objs)</span><br>    <span class="hljs-variable">$(CC)</span> <span class="hljs-variable">$(objs)</span> -o <span class="hljs-variable">$(target)</span><br><br><span class="hljs-section">%.o:%.c</span><br>    <span class="hljs-variable">$(CC)</span> -c <span class="hljs-variable">$&lt;</span> -o <span class="hljs-variable">$@</span><br><br><span class="hljs-meta"><span class="hljs-keyword">.PHONY</span>:clean</span><br><span class="hljs-section">clean:</span><br>    rm <span class="hljs-variable">$(objs)</span> -f<br></code></pre></td></tr></table></figure><h2 id="GDB-调试"><a href="#GDB-调试" class="headerlink" title="GDB 调试"></a>GDB 调试</h2><p>命令:</p><p>向可执行程序中加入调试信息.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">gcc -g test.c -o test<br></code></pre></td></tr></table></figure><p>启动&#x2F;退出 gdb:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">gdb [可执行文件] # 启动<br><br>(gdb) q/quit # 退出 gdb<br></code></pre></td></tr></table></figure><p>gdb 常用命令:</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># 给程序设置参数/获取设置参数</span><br>(gdb) set args 10 20    <span class="hljs-comment"># 设置函数参数</span><br>(gdb) show args         <span class="hljs-comment"># 获取函数参数</span><br><br>(gdb) help [command] <span class="hljs-comment"># 查看帮助文档</span><br><br><span class="hljs-comment"># 查看当前文件代码</span><br>(gdb) list/l        <span class="hljs-comment"># 从默认位置显, 默认10行</span><br>(gdb) list/l line   <span class="hljs-comment"># 从指定的行显示, 行号上下文</span><br>(gdb) list/l func   <span class="hljs-comment"># 从指定的函数显示, func上下文</span><br><br><span class="hljs-comment"># 查看非当前文件代码</span><br>(gdb) list/l filename : line<br>(gdb) list/l filename : func<br><br><span class="hljs-comment"># 设置显示的行数</span><br>(gdb) show list/listsize<br>(gdb) set list/listsize line<br><br><span class="hljs-comment"># 设置断点</span><br>(gdb) b/break line<br>(gdb) b/break func<br>(gdb) b/break filename : line<br>(gdb) b/break filename : func<br><br><span class="hljs-comment"># 查看断点</span><br>(gdb) i/info b/break<br><br><span class="hljs-comment"># 删除断点</span><br>(gdb) d/del/delete brk_num<br><br><span class="hljs-comment"># 设置断点无效</span><br>(gdb) dis/disable brk_num<br><br><span class="hljs-comment"># 设置断点生效</span><br>(gdb) en/enable brk_num<br><br><span class="hljs-comment"># 设置条件断点 (一般用在循环位置)</span><br>(gdb) b/break 10 if i==5<br><br><span class="hljs-comment"># 运行GDB程序</span><br>(gdb) start     <span class="hljs-comment"># 停在main第一行</span><br>(gdb) run       <span class="hljs-comment"># 停在第一个断点</span><br><br><span class="hljs-comment"># 继续运行</span><br>(gdb) c/continue    <span class="hljs-comment"># 下一个断点</span><br>(gdb) n/next        <span class="hljs-comment"># 下一行, 不会进入函数体</span><br>(gdb) s/step        <span class="hljs-comment"># 单步调试, 会进入函数体</span><br>(gdb) finish        <span class="hljs-comment"># 跳出函数体</span><br><br><span class="hljs-comment"># 变量操作</span><br>(gdb) p/print variable      <span class="hljs-comment"># 打印变量值</span><br>(gdb) ptype   variable      <span class="hljs-comment"># 打印变量类型</span><br><br><span class="hljs-comment"># 自动变量操作</span><br>(gdb) display variable <span class="hljs-comment"># 自动打印指定变量</span><br>(gdb) i/info display<br>(gdb) undisplay no.<br><br><span class="hljs-comment"># 其他操作</span><br>(gdb) set var variable = value  <span class="hljs-comment"># 设置变量的值</span><br>(gdb) until                     <span class="hljs-comment"># 跳出循环</span><br></code></pre></td></tr></table></figure><p>gdb 不输入命名按回车默认执行上一条命令。</p><h2 id="文件-IO"><a href="#文件-IO" class="headerlink" title="文件 IO"></a>文件 IO</h2><h3 id="标准-C-库-IO-函数"><a href="#标准-C-库-IO-函数" class="headerlink" title="标准 C 库 IO 函数"></a>标准 C 库 IO 函数</h3><p>标准 C 库中的IO函数 调用操作系统的 API，可以跨平台。<br>标准 C 库的IO函数带有缓冲区，效率较高。</p><p><img src="https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/202208120301129.png" srcset="/img/loading.gif" lazyload alt="![](https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/202208120301129.png)"></p><h3 id="虚拟地址空间"><a href="#虚拟地址空间" class="headerlink" title="虚拟地址空间"></a>虚拟地址空间</h3><p>32位操作系统的虚拟地址空间：</p><p><img src="https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/202208120308467.png" srcset="/img/loading.gif" lazyload alt="虚拟地址空间"></p><h3 id="文件描述符"><a href="#文件描述符" class="headerlink" title="文件描述符"></a>文件描述符</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">文件描述符</span><br>0 -&gt; STDIN_FILENO		# 标准输入<br>1 -&gt; STDOUT_FILENO		# 标准输出<br>2 -&gt; STDERR_FILENO		# 标准错误<br></code></pre></td></tr></table></figure><p><img src="https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/202208120322763.png" srcset="/img/loading.gif" lazyload alt="文件描述符"></p><p>文件描述符表是一个数组，默认大小为1024。前三个元素被占用，默认打开，指向当前终端。</p><h3 id="Linux-系统-IO-函数"><a href="#Linux-系统-IO-函数" class="headerlink" title="Linux 系统 IO 函数"></a>Linux 系统 IO 函数</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">open</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *pathname, <span class="hljs-type">int</span> flags)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">open</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *pathname, <span class="hljs-type">int</span> flags, <span class="hljs-type">mode_t</span> mode)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">close</span><span class="hljs-params">(<span class="hljs-type">int</span> fd)</span>; <span class="hljs-comment">// 关闭文件描述符，fd 不再指向任何文件，并可以被再次使用</span><br><span class="hljs-type">ssize_t</span> <span class="hljs-title function_">read</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">void</span> *buf, <span class="hljs-type">size_t</span> count)</span>;<br><span class="hljs-type">ssize_t</span> <span class="hljs-title function_">write</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">const</span> <span class="hljs-type">void</span> *buf, <span class="hljs-type">size_t</span> count)</span>;<br><span class="hljs-type">off_t</span> <span class="hljs-title function_">lseek</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">off_t</span> offset, <span class="hljs-type">int</span> whence)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">stat</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *pathname, <span class="hljs-keyword">struct</span> stat *statbuf)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">lstat</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *pathname, <span class="hljs-keyword">struct</span> stat *statbuf)</span>;<br></code></pre></td></tr></table></figure><p>可使用<code>man</code> 命令查看说明文档：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">man 2 open<br></code></pre></td></tr></table></figure><h4 id="open-系统调用"><a href="#open-系统调用" class="headerlink" title="open 系统调用"></a>open 系统调用</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 所需头文件: </span><br><span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span>      <span class="hljs-comment">// flags : 权限标记, Linux 里定义为宏, 在前两个头文件里</span></span><br><span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span>       <span class="hljs-comment">//</span></span><br><span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span>          <span class="hljs-comment">// open 的函数声明</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">open</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *pathname, <span class="hljs-type">int</span> flags)</span>; <span class="hljs-comment">// 打开一个已存在文件</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">open</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *pathname, <span class="hljs-type">int</span> flags, <span class="hljs-type">mode_t</span> mode)</span>; <span class="hljs-comment">// 创建一个新的文件</span><br></code></pre></td></tr></table></figure><p>C 没有函数重载, 两个 open 通过可变参数实现:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">open</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *pathname, <span class="hljs-type">int</span> flags, ...)</span>;<br></code></pre></td></tr></table></figure><p>打开一个已存在文件：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment">    // 打开一个已存在文件</span><br><span class="hljs-comment">    int open(const char *pathname, int flags);</span><br><span class="hljs-comment">        parameters:</span><br><span class="hljs-comment">            pathname : 要打开的文件路径</span><br><span class="hljs-comment">            flags    : 对文件的操作权限设置和其他设置</span><br><span class="hljs-comment">                必选 : O_RDONLY, O_WRONLY, or O_RDWR. 这三个互斥</span><br><span class="hljs-comment">                可选 : O_APPEND, O_CREAT, O_TRUNC 等 </span><br><span class="hljs-comment"></span><br><span class="hljs-comment">        return value :</span><br><span class="hljs-comment">            成功返回新的文件描述符, 失败返回 -1 </span><br><span class="hljs-comment">        errno : </span><br><span class="hljs-comment">            属于 Linux 系统函数库, 库里面的全局变量, 记录的是最近的错误号</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    perror函数</span><br><span class="hljs-comment">    # include &lt;stdio.h&gt;</span><br><span class="hljs-comment">    // 打印对应 errno 对应的错误描述</span><br><span class="hljs-comment">    void perror(const char *s);</span><br><span class="hljs-comment">    输出: s: system error message</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span>      <span class="hljs-comment">// flag : 权限标记, Linux 里定义为宏, 在前两个头文件里</span></span><br><span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span>       <span class="hljs-comment">//</span></span><br><span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span>          <span class="hljs-comment">// open 的函数声明</span></span><br><span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br><br>    <span class="hljs-type">int</span> fd = open(<span class="hljs-string">&quot;a.txt&quot;</span>, O_RDONLY); <span class="hljs-comment">// 当前目录不存在 a.txt</span><br><br>    <span class="hljs-keyword">if</span>(fd == <span class="hljs-number">-1</span>) &#123;<br>        perror(<span class="hljs-string">&quot;open&quot;</span>); <span class="hljs-comment">// 输出 : open: No such file or directory</span><br>    &#125;<br><br>    <span class="hljs-comment">// 关闭文件描述符</span><br>    close(fd);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>创建一个新的文件：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment"># include &lt;sys/types.h&gt;      // flags : 权限标记, Linux 里定义为宏, 在前两个头文件里</span><br><span class="hljs-comment"># include &lt;sys/stat.h&gt;       //</span><br><span class="hljs-comment"># include &lt;fcntl.h&gt;          // open 的函数声明</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">// 创建一个新的文件</span><br><span class="hljs-comment">int open(const char *pathname, int flags, mode_t mode);</span><br><span class="hljs-comment">    parameters:</span><br><span class="hljs-comment">        pathname : 要打开的文件路径</span><br><span class="hljs-comment">        flags    : 对文件的操作权限设置和其他设置</span><br><span class="hljs-comment">            必选 : O_RDONLY, O_WRONLY, or O_RDWR. 这三个互斥</span><br><span class="hljs-comment">            可选 :  O_APPEND, O_CREAT, O_TRUNC 等 </span><br><span class="hljs-comment">        mode: 八进制数, 表示创建出的文件操作权限, 比如 0775, 0 表示八进制</span><br><span class="hljs-comment">            最终的权限是 mode &amp; ~umask</span><br><span class="hljs-comment">                </span><br><span class="hljs-comment">    return value :</span><br><span class="hljs-comment">        成功返回新的文件描述符, 失败返回 -1 </span><br><span class="hljs-comment">*/</span><br><br><br><span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span>      <span class="hljs-comment">// flag : 权限标记, Linux 里定义为宏, 在前两个头文件里</span></span><br><span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span>       <span class="hljs-comment">//</span></span><br><span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span>          <span class="hljs-comment">// open 的函数声明</span></span><br><span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br><br>    <span class="hljs-type">int</span> fd = open(<span class="hljs-string">&quot;create.txt&quot;</span>, O_RDWR | O_CREAT, <span class="hljs-number">0777</span>); <span class="hljs-comment">// 创建 create.txt</span><br><br>    <span class="hljs-keyword">if</span>(fd == <span class="hljs-number">-1</span>) &#123;<br>        perror(<span class="hljs-string">&quot;open&quot;</span>); <br>    &#125;<br><br>    <span class="hljs-comment">// 关闭文件描述符</span><br>    close(fd);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="read、write"><a href="#read、write" class="headerlink" title="read、write"></a>read、write</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*  </span><br><span class="hljs-comment">    #include &lt;unistd.h&gt;</span><br><span class="hljs-comment">    ssize_t read(int fd, void *buf, size_t count);</span><br><span class="hljs-comment">        参数：</span><br><span class="hljs-comment">            - fd：文件描述符，open得到的，通过这个文件描述符操作某个文件</span><br><span class="hljs-comment">            - buf：需要读取数据存放的地方，数组的地址（传出参数）</span><br><span class="hljs-comment">            - count：指定的数组的大小</span><br><span class="hljs-comment">        返回值：</span><br><span class="hljs-comment">            - 成功：</span><br><span class="hljs-comment">                &gt;0: 返回实际的读取到的字节数</span><br><span class="hljs-comment">                =0：文件已经读取完了</span><br><span class="hljs-comment">            - 失败：-1 ，并且设置errno</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    #include &lt;unistd.h&gt;</span><br><span class="hljs-comment">    ssize_t write(int fd, const void *buf, size_t count);</span><br><span class="hljs-comment">        参数：</span><br><span class="hljs-comment">            - fd：文件描述符，open得到的，通过这个文件描述符操作某个文件</span><br><span class="hljs-comment">            - buf：要往磁盘写入的数据，数据</span><br><span class="hljs-comment">            - count：要写的数据的实际的大小</span><br><span class="hljs-comment">        返回值：</span><br><span class="hljs-comment">            成功：实际写入的字节数</span><br><span class="hljs-comment">            失败：返回-1，并设置errno</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br><br>    <span class="hljs-comment">// 1.通过open打开english.txt文件</span><br>    <span class="hljs-type">int</span> srcfd = open(<span class="hljs-string">&quot;english.txt&quot;</span>, O_RDONLY);<br>    <span class="hljs-keyword">if</span>(srcfd == <span class="hljs-number">-1</span>) &#123;<br>        perror(<span class="hljs-string">&quot;open&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 2.创建一个新的文件（拷贝文件）</span><br>    <span class="hljs-type">int</span> destfd = open(<span class="hljs-string">&quot;cpy.txt&quot;</span>, O_WRONLY | O_CREAT, <span class="hljs-number">0664</span>);<br>    <span class="hljs-keyword">if</span>(destfd == <span class="hljs-number">-1</span>) &#123;<br>        perror(<span class="hljs-string">&quot;open&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 3.频繁的读写操作</span><br>    <span class="hljs-type">char</span> buf[<span class="hljs-number">1024</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <span class="hljs-type">int</span> len = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>((len = read(srcfd, buf, <span class="hljs-keyword">sizeof</span>(buf))) &gt; <span class="hljs-number">0</span>) &#123;<br>        write(destfd, buf, len);<br>    &#125;<br><br>    <span class="hljs-comment">// 4.关闭文件</span><br>    close(destfd);<br>    close(srcfd);<br><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="lseek"><a href="#lseek" class="headerlink" title="lseek"></a>lseek</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*  </span><br><span class="hljs-comment">    标准C库的函数</span><br><span class="hljs-comment">    #include &lt;stdio.h&gt;</span><br><span class="hljs-comment">    int fseek(FILE *stream, long offset, int whence);</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    Linux系统函数，重置文件指针偏移量</span><br><span class="hljs-comment">    #include &lt;sys/types.h&gt;</span><br><span class="hljs-comment">    #include &lt;unistd.h&gt;</span><br><span class="hljs-comment">    off_t lseek(int fd, off_t offset, int whence);</span><br><span class="hljs-comment">        参数：</span><br><span class="hljs-comment">            - fd：文件描述符，通过open得到的，通过这个fd操作某个文件</span><br><span class="hljs-comment">            - offset：偏移量，偏移量一旦超出了文件的长度，下一次进行文件IO写入操作文件的时候便会延续偏移量的位置继续写入，进而在文件中间产生了空洞的部分，这部分会以”\0”填充，而从原来的文件结尾到新写入数据间的这段空间就被称为“文件空洞”。</span><br><span class="hljs-comment">            - whence:</span><br><span class="hljs-comment">                SEEK_SET</span><br><span class="hljs-comment">                    设置文件指针的偏移量</span><br><span class="hljs-comment">                SEEK_CUR</span><br><span class="hljs-comment">                    设置偏移量：当前位置 + 第二个参数offset的值</span><br><span class="hljs-comment">                SEEK_END</span><br><span class="hljs-comment">                    设置偏移量：文件大小 + 第二个参数offset的值</span><br><span class="hljs-comment">        返回值：返回当前位置到文件开始位置以字节为单位的偏移量</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    作用：</span><br><span class="hljs-comment">        1.移动文件指针到文件头</span><br><span class="hljs-comment">        lseek(fd, 0, SEEK_SET);</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">        2.获取当前文件指针的位置</span><br><span class="hljs-comment">        lseek(fd, 0, SEEK_CUR);</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">        3.获取文件长度</span><br><span class="hljs-comment">        lseek(fd, 0, SEEK_END);</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br><br>    <span class="hljs-comment">//原始文件内容: hello,world</span><br>    <span class="hljs-type">int</span> fd = open(<span class="hljs-string">&quot;hello.txt&quot;</span>, O_RDWR);<br><br>    <span class="hljs-keyword">if</span>(fd == <span class="hljs-number">-1</span>) &#123;<br>        perror(<span class="hljs-string">&quot;open&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 扩展文件的长度</span><br>    <span class="hljs-type">int</span> ret = lseek(fd, <span class="hljs-number">10000000</span>, SEEK_END);<br>    <span class="hljs-keyword">if</span>(ret == <span class="hljs-number">-1</span>) &#123;<br>        perror(<span class="hljs-string">&quot;lseek&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 在offset = 10000011处写入一个数据</span><br>    write(fd, <span class="hljs-string">&quot;.&quot;</span>, SEEK_CUR);<br><br>    <span class="hljs-comment">// 关闭文件</span><br>    close(fd);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><blockquote><p>什么是空洞文件(hole file)？在Linux中，lseek的系统调用是可以改变在文件上面的偏移量的，而且还允许其超出文件的长度。偏移量一旦超出了文件的长度，下一次进行文件IO写入操作文件的时候便会延续偏移量的位置继续写入，进而在文件中间产生了空洞的部分，这部分会以”\0”填充，而从原来的文件结尾到新写入数据间的这段空间就被称为“<strong>文件空洞</strong>”。</p><p>在Linux中，EOF（文件结束符）并不是一个字符，而是在读取到文件末尾的时候返回的一个信号值，也就是-1。</p><p>文件空洞部分实际上是不会占用任何的物理空间的，直到在某个时刻对空洞部分进行写入文件内容的时候才会为它分配对应的空间。但是在空洞文件形成的时候，逻辑上面的文件大小是分配了空洞部分的大小的。</p></blockquote><p>生成元素文件 hello.txt 的拷贝：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cp hello.txt hello.prev<br></code></pre></td></tr></table></figure><p>编译上述代码后运行。</p><p>使用od命令来查看<code>hello.txt</code>文件的二进制内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">od -c hello.txt<br></code></pre></td></tr></table></figure><p><img src="https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/202208121756971.png" srcset="/img/loading.gif" lazyload alt="od -c hello.txt"></p><p>使用ls查看文件的逻辑大小：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs she">ls -lh hello.*<br></code></pre></td></tr></table></figure><p><img src="https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/202208121800438.png" srcset="/img/loading.gif" lazyload alt="逻辑大小"></p><p>逻辑大小：</p><p>hello.prev: 11 Bytes</p><p>hello.txt: 10000012 Bytes &#x3D; 10000012 &#x2F; 1024 &#x2F; 1024 M &#x3D; 9.6 M</p><p>使用du查看文件实际占用物理块的大小：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">du -h hello.*<br></code></pre></td></tr></table></figure><p><img src="https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/202208121800966.png" srcset="/img/loading.gif" lazyload alt="实际占用物理块"></p><p>文件系统的基本操作单位是数据块，Linux 中的逻辑块大小为 <code>4KB</code>，所以 hello.prev 实际占用的空间为 4k，由于 <code>&quot;hello,world&quot;</code> 和 <code>&quot;.&quot;</code> 在逻辑上不在一个块内，所以 hello.txt 实际占用的空间为 8k，远小于 9.6 M，所以文件空洞部分实际上是不会占用任何的物理空间的。</p><h4 id="stat、lstat"><a href="#stat、lstat" class="headerlink" title="stat、lstat"></a>stat、lstat</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment">    #include &lt;sys/types.h&gt;</span><br><span class="hljs-comment">    #include &lt;sys/stat.h&gt;</span><br><span class="hljs-comment">    #include &lt;unistd.h&gt;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    int stat(const char *pathname, struct stat *statbuf);</span><br><span class="hljs-comment">        作用：获取一个文件相关的一些信息</span><br><span class="hljs-comment">        参数:</span><br><span class="hljs-comment">            - pathname：操作的文件的路径</span><br><span class="hljs-comment">            - statbuf：结构体变量，传出参数，用于保存获取到的文件的信息</span><br><span class="hljs-comment">        返回值：</span><br><span class="hljs-comment">            成功：返回0</span><br><span class="hljs-comment">            失败：返回-1 设置errno</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    int lstat(const char *pathname, struct stat *statbuf);</span><br><span class="hljs-comment">        参数:</span><br><span class="hljs-comment">            - pathname：操作的文件的路径</span><br><span class="hljs-comment">            - statbuf：结构体变量，传出参数，用于保存获取到的文件的信息</span><br><span class="hljs-comment">        返回值：</span><br><span class="hljs-comment">            成功：返回0</span><br><span class="hljs-comment">            失败：返回-1 设置errno</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><p><code>stat</code>和<code>lstat</code>的区别：当文件是一个符号链接时，<code>lstat</code>返回的是该符号链接本身的信息；而<code>stat</code>返回的是该链接指向的文件的信息。</p><p>stat 结构体：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">stat</span> &#123;</span><br>    <span class="hljs-type">dev_t</span>		st_dev;			<span class="hljs-comment">// 文件的设备编号</span><br>    <span class="hljs-type">ino_t</span>		st_ino;			<span class="hljs-comment">// 节点</span><br>    <span class="hljs-type">mode_t</span>		st_mode;		<span class="hljs-comment">// 文件的类型和存取的权限</span><br>    <span class="hljs-type">nlink_t</span>		st_nlink;		<span class="hljs-comment">// 连到该文件的硬连接数目</span><br>    <span class="hljs-type">uid_t</span>		st_uid;			<span class="hljs-comment">// 用户ID</span><br>    <span class="hljs-type">gid_t</span> 		st_gid;			<span class="hljs-comment">// 组ID</span><br>    <span class="hljs-type">dev_t</span>		st_rdev;		<span class="hljs-comment">// 设备文件的设备编号</span><br>    <span class="hljs-type">off_t</span>		st_size;      	<span class="hljs-comment">// 文件字节数(文件大小)</span><br>    <span class="hljs-type">blksize_t</span>	st_blksize;   	<span class="hljs-comment">// 最优的 IO 块大小，Linux 为 4096B</span><br>    <span class="hljs-type">blkcnt_t</span>	st_blocks;    	<span class="hljs-comment">// 块数（以 512B 为单位，而不是 4096B，实际的物理意义应该是磁盘扇区数）</span><br>    <br>    <span class="hljs-type">time_t</span>		st_atime;     	<span class="hljs-comment">// 最后一次访问时间</span><br>    <span class="hljs-type">time_t</span>		st_mtime;     	<span class="hljs-comment">// 最后一次修改时间</span><br>    <span class="hljs-type">time_t</span>		st_ctime;     	<span class="hljs-comment">// 最后一次改变时间(指属性)</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>使用stat命令查看文件的stat结构体（没有lstat命令）：</p><p><img src="https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/202208121836144.png" srcset="/img/loading.gif" lazyload alt="stat 命令"></p><p>hello.txt : Blocks &#x3D; 8K &#x2F; 512B &#x3D; 16</p><p>hello.prev: Blocks &#x3D; 4K &#x2F; 512B &#x3D; 8</p><p>st_mode 变量（16位）：</p><p><img src="https://blog-1312962011.cos.ap-nanjing.myqcloud.com/imgs/202208121841823.png" srcset="/img/loading.gif" lazyload alt="st_mode 变量"></p><h4 id="文件属性的操作函数"><a href="#文件属性的操作函数" class="headerlink" title="文件属性的操作函数"></a>文件属性的操作函数</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">access</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *pathname, <span class="hljs-type">int</span> mode)</span>; <span class="hljs-comment">// 判断某个文件是否有某个权限，或者判断文件是否存在</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">chmod</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *filename, <span class="hljs-type">int</span> mode)</span>; 	<span class="hljs-comment">// 修改文件的权限</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">chown</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *path, <span class="hljs-type">uid_t</span> owner, <span class="hljs-type">gid_t</span> group)</span>;	<span class="hljs-comment">// 修改文件所有者或者所在组</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">truncate</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *path, <span class="hljs-type">off_t</span> length)</span>; <span class="hljs-comment">// 缩减或者扩展文件的尺寸至指定的大小，不会占用实际的物理内存，多余的部分实际上是一个文件空洞</span><br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment">    #include &lt;unistd.h&gt;</span><br><span class="hljs-comment">    int access(const char *pathname, int mode);</span><br><span class="hljs-comment">        作用：判断某个文件是否有某个权限，或者判断文件是否存在</span><br><span class="hljs-comment">        参数：</span><br><span class="hljs-comment">            - pathname: 判断的文件路径</span><br><span class="hljs-comment">            - mode:</span><br><span class="hljs-comment">                R_OK: 判断是否有读权限</span><br><span class="hljs-comment">                W_OK: 判断是否有写权限</span><br><span class="hljs-comment">                X_OK: 判断是否有执行权限</span><br><span class="hljs-comment">                F_OK: 判断文件是否存在</span><br><span class="hljs-comment">        返回值：成功返回0， 失败返回-1</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">    #include &lt;sys/stat.h&gt;</span><br><span class="hljs-comment">    int chmod(const char *pathname, mode_t mode);</span><br><span class="hljs-comment">        修改文件的权限</span><br><span class="hljs-comment">        参数：</span><br><span class="hljs-comment">            - pathname: 需要修改的文件的路径</span><br><span class="hljs-comment">            - mode:需要修改的权限值，八进制的数</span><br><span class="hljs-comment">        返回值：成功返回0，失败返回-1</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">    #include &lt;unistd.h&gt;</span><br><span class="hljs-comment">    #include &lt;sys/types.h&gt;</span><br><span class="hljs-comment">    int truncate(const char *path, off_t length);</span><br><span class="hljs-comment">        作用：缩减或者扩展文件的尺寸至指定的大小，不会占用实际的物理内存，多余的部分实际上是一个文件空洞</span><br><span class="hljs-comment">        参数：</span><br><span class="hljs-comment">            - path: 需要修改的文件的路径</span><br><span class="hljs-comment">            - length: 需要最终文件变成的大小</span><br><span class="hljs-comment">        返回值：</span><br><span class="hljs-comment">            成功返回0， 失败返回-1</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h4 id="目录的操作函数"><a href="#目录的操作函数" class="headerlink" title="目录的操作函数"></a>目录的操作函数</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">rename</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *oldpath, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *newpath)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">chdir</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *path)</span>;<br><span class="hljs-type">char</span> *<span class="hljs-title function_">getcwd</span><span class="hljs-params">(<span class="hljs-type">char</span> *buf, <span class="hljs-type">size_t</span> size)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">mkdir</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *pathname, <span class="hljs-type">mode_t</span> mode)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">rmdir</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *pathname)</span>;<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment">    #include &lt;sys/stat.h&gt;</span><br><span class="hljs-comment">    #include &lt;sys/types.h&gt;</span><br><span class="hljs-comment">    int mkdir(const char *pathname, mode_t mode);</span><br><span class="hljs-comment">        作用：创建一个目录</span><br><span class="hljs-comment">        参数：</span><br><span class="hljs-comment">            pathname: 创建的目录的路径</span><br><span class="hljs-comment">            mode: 权限，八进制的数</span><br><span class="hljs-comment">        返回值：</span><br><span class="hljs-comment">            成功返回0， 失败返回-1</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    #include &lt;unistd.h&gt;</span><br><span class="hljs-comment">    int chdir(const char *path);</span><br><span class="hljs-comment">        作用：修改进程的工作目录</span><br><span class="hljs-comment">        参数：</span><br><span class="hljs-comment">            path : 需要修改的工作目录</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    #include &lt;unistd.h&gt;</span><br><span class="hljs-comment">    char *getcwd(char *buf, size_t size);</span><br><span class="hljs-comment">        作用：获取当前工作目录</span><br><span class="hljs-comment">        参数：</span><br><span class="hljs-comment">            - buf : 存储的路径，指向的是一个数组（传出参数）</span><br><span class="hljs-comment">            - size: 数组的大小</span><br><span class="hljs-comment">        返回值：</span><br><span class="hljs-comment">            返回的指向的一块内存，这个数据就是第一个参数</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h4 id="目录的遍历函数"><a href="#目录的遍历函数" class="headerlink" title="目录的遍历函数"></a>目录的遍历函数</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs c">DIR *<span class="hljs-title function_">opendir</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *name)</span>;<br><span class="hljs-keyword">struct</span> dirent *<span class="hljs-title function_">readdir</span><span class="hljs-params">(DIR *dirp)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">closedir</span><span class="hljs-params">(DIR *dirp)</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dirent</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-comment">// 此目录进入点的inode</span><br>    <span class="hljs-type">ino_t</span> d_ino; <br>    <span class="hljs-comment">// 目录文件开头至此目录进入点的位移</span><br>    <span class="hljs-type">off_t</span> d_off;   <br>    <span class="hljs-comment">// d_name 的长度, 不包含NULL字符</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> <span class="hljs-type">int</span> d_reclen; <br>    <span class="hljs-comment">// d_name 所指的文件类型</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> d_type;   <br>    <span class="hljs-comment">// 文件名</span><br>    <span class="hljs-type">char</span> d_name[<span class="hljs-number">256</span>];<br>&#125;;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">d_type</span><br><span class="hljs-comment">    DT_BLK - 块设备</span><br><span class="hljs-comment">    DT_CHR - 字符设备</span><br><span class="hljs-comment">    DT_DIR - 目录</span><br><span class="hljs-comment">    DT_LNK - 软连接</span><br><span class="hljs-comment">    DT_FIFO - 管道</span><br><span class="hljs-comment">    DT_REG - 普通文件</span><br><span class="hljs-comment">    DT_SOCK - 套接字</span><br><span class="hljs-comment">    DT_UNKNOWN - 未知</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">    // 打开一个目录</span><br><span class="hljs-comment">    #include &lt;sys/types.h&gt;</span><br><span class="hljs-comment">    #include &lt;dirent.h&gt;</span><br><span class="hljs-comment">    DIR *opendir(const char *name);</span><br><span class="hljs-comment">        参数：</span><br><span class="hljs-comment">            - name: 需要打开的目录的名称</span><br><span class="hljs-comment">        返回值：</span><br><span class="hljs-comment">            DIR * 类型，理解为目录流</span><br><span class="hljs-comment">            错误返回NULL</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    // 读取目录中的数据</span><br><span class="hljs-comment">    #include &lt;dirent.h&gt;</span><br><span class="hljs-comment">    struct dirent *readdir(DIR *dirp);</span><br><span class="hljs-comment">        - 参数：dirp是opendir返回的结果</span><br><span class="hljs-comment">        - 返回值：</span><br><span class="hljs-comment">            struct dirent，代表读取到的文件的信息</span><br><span class="hljs-comment">            读取到了末尾或者失败了，返回NULL</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    // 关闭目录</span><br><span class="hljs-comment">    #include &lt;sys/types.h&gt;</span><br><span class="hljs-comment">    #include &lt;dirent.h&gt;</span><br><span class="hljs-comment">    int closedir(DIR *dirp);</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">*/</span><br><br></code></pre></td></tr></table></figure><p>读取某个目录下所有的普通文件的个数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;dirent.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-comment">// #define __USE_MISC </span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">getFileNum</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> * path)</span>;<br><br><span class="hljs-comment">// 读取某个目录下所有的普通文件的个数</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> * argv[])</span> &#123;<br><br>    <span class="hljs-keyword">if</span>(argc &lt; <span class="hljs-number">2</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s path\n&quot;</span>, argv[<span class="hljs-number">0</span>]);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-type">int</span> num = getFileNum(argv[<span class="hljs-number">1</span>]);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;普通文件的个数为：%d\n&quot;</span>, num);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// 用于获取目录下所有普通文件的个数</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">getFileNum</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> * path)</span> &#123;<br><br>    <span class="hljs-comment">// 1.打开目录</span><br>    DIR * dir = opendir(path);<br><br>    <span class="hljs-keyword">if</span>(dir == <span class="hljs-literal">NULL</span>) &#123;<br>        perror(<span class="hljs-string">&quot;opendir&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dirent</span> *<span class="hljs-title">ptr</span>;</span><br><br>    <span class="hljs-comment">// 记录普通文件的个数</span><br>    <span class="hljs-type">int</span> total = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">while</span>((ptr = readdir(dir)) != <span class="hljs-literal">NULL</span>) &#123;<br><br>        <span class="hljs-comment">// 获取名称</span><br>        <span class="hljs-type">char</span> * dname = ptr-&gt;d_name;<br><br>        <span class="hljs-comment">// 忽略掉. 和..</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(dname, <span class="hljs-string">&quot;.&quot;</span>) == <span class="hljs-number">0</span> || <span class="hljs-built_in">strcmp</span>(dname, <span class="hljs-string">&quot;..&quot;</span>) == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 判断是否是普通文件还是目录</span><br>        <span class="hljs-keyword">if</span>(ptr-&gt;d_type == DT_DIR) &#123;<br>            <span class="hljs-comment">// 目录,需要继续读取这个目录</span><br>            <span class="hljs-type">char</span> newpath[<span class="hljs-number">256</span>];<br>            <span class="hljs-built_in">sprintf</span>(newpath, <span class="hljs-string">&quot;%s/%s&quot;</span>, path, dname);<br>            total += getFileNum(newpath);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(ptr-&gt;d_type == DT_REG) &#123;<br>            <span class="hljs-comment">// 普通文件</span><br>            total++;<br>        &#125;<br><br><br>    &#125;<br><br>    <span class="hljs-comment">// 关闭目录</span><br>    closedir(dir);<br><br>    <span class="hljs-keyword">return</span> total;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="dup、dup2"><a href="#dup、dup2" class="headerlink" title="dup、dup2"></a>dup、dup2</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">dup</span><span class="hljs-params">(<span class="hljs-type">int</span> oldfd)</span>;					<span class="hljs-comment">// 复制文件描述符，返回最小的未使用的文件描述符</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">dup2</span><span class="hljs-params">(<span class="hljs-type">int</span> oldfd, <span class="hljs-type">int</span> newfd)</span>;		<span class="hljs-comment">// 重定向文件描述符</span><br></code></pre></td></tr></table></figure><p>dup 函数示例：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment">    #include &lt;unistd.h&gt;</span><br><span class="hljs-comment">    int dup(int oldfd);</span><br><span class="hljs-comment">        作用：复制一个新的文件描述符</span><br><span class="hljs-comment">        fd=3, int fd1 = dup(fd),</span><br><span class="hljs-comment">        fd指向的是a.txt, fd1也是指向a.txt</span><br><span class="hljs-comment">        从空闲的文件描述符表中找一个最小的，作为新的拷贝的文件描述符</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br><br>    <span class="hljs-type">int</span> fd = open(<span class="hljs-string">&quot;a.txt&quot;</span>, O_RDWR | O_CREAT, <span class="hljs-number">0664</span>);<br><br>    <span class="hljs-type">int</span> fd1 = dup(fd); <span class="hljs-comment">// 关闭文件描述符</span><br><br>    <span class="hljs-keyword">if</span>(fd1 == <span class="hljs-number">-1</span>) &#123;<br>        perror(<span class="hljs-string">&quot;dup&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;fd : %d , fd1 : %d\n&quot;</span>, fd, fd1);<br><br>    close(fd);<br><br>    <span class="hljs-type">char</span> * str = <span class="hljs-string">&quot;hello,world&quot;</span>;<br>    <span class="hljs-type">int</span> ret = write(fd1, str, <span class="hljs-built_in">strlen</span>(str)); <span class="hljs-comment">// 通过 fd1 向文件中写入 &quot;hello,world&quot;</span><br>    <span class="hljs-keyword">if</span>(ret == <span class="hljs-number">-1</span>) &#123;<br>        perror(<span class="hljs-string">&quot;write&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    close(fd1);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>dup2 函数示例：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment">    #include &lt;unistd.h&gt;</span><br><span class="hljs-comment">    int dup2(int oldfd, int newfd);</span><br><span class="hljs-comment">        作用：重定向文件描述符, 复制文件描述符并指定新的文件描述符为 newfd</span><br><span class="hljs-comment">        调用函数成功后 oldfd 指向 a.txt, newfd 指向 b.txt</span><br><span class="hljs-comment">        如果 newfd 本身和 b.txt 关联，则在复制文件描述符前关闭文件描述符 newfd，使其不再指向 b.txt，然后将其重新指向a.txt</span><br><span class="hljs-comment">        oldfd 必须是一个有效的文件描述符</span><br><span class="hljs-comment">        oldfd 和 newfd值相同，相当于什么都没有做</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br><br>    <span class="hljs-type">int</span> fd = open(<span class="hljs-string">&quot;1.txt&quot;</span>, O_RDWR | O_CREAT, <span class="hljs-number">0664</span>);<br>    <span class="hljs-keyword">if</span>(fd == <span class="hljs-number">-1</span>) &#123;<br>        perror(<span class="hljs-string">&quot;open&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-type">int</span> fd1 = open(<span class="hljs-string">&quot;2.txt&quot;</span>, O_RDWR | O_CREAT, <span class="hljs-number">0664</span>);<br>    <span class="hljs-keyword">if</span>(fd1 == <span class="hljs-number">-1</span>) &#123;<br>        perror(<span class="hljs-string">&quot;open&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;fd : %d, fd1 : %d\n&quot;</span>, fd, fd1);<br><br>    <span class="hljs-type">int</span> fd2 = dup2(fd, fd1);<br>    <span class="hljs-keyword">if</span>(fd2 == <span class="hljs-number">-1</span>) &#123;<br>        perror(<span class="hljs-string">&quot;dup2&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 通过fd1去写数据，实际操作的是1.txt，而不是2.txt</span><br>    <span class="hljs-type">char</span> * str = <span class="hljs-string">&quot;hello, dup2&quot;</span>;<br>    <span class="hljs-type">int</span> len = write(fd1, str, <span class="hljs-built_in">strlen</span>(str));<br><br>    <span class="hljs-keyword">if</span>(len == <span class="hljs-number">-1</span>) &#123;<br>        perror(<span class="hljs-string">&quot;write&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;fd : %d, fd1 : %d, fd2 : %d\n&quot;</span>, fd, fd1, fd2);<br><br>    close(fd);<br>    close(fd1);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="fcntl-函数"><a href="#fcntl-函数" class="headerlink" title="fcntl 函数"></a>fcntl 函数</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">fcntl</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">int</span> cmd, ... <span class="hljs-comment">/* arg */</span> )</span>;<br><span class="hljs-comment">// 使用 cmd 操作文件文件描述符，如复制文件描述符、设置/获取文件的状态标志等</span><br></code></pre></td></tr></table></figure><p>示例：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    #include &lt;unistd.h&gt;</span><br><span class="hljs-comment">    #include &lt;fcntl.h&gt;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    int fcntl(int fd, int cmd, ...);</span><br><span class="hljs-comment">    参数：</span><br><span class="hljs-comment">        fd : 表示需要操作的文件描述符</span><br><span class="hljs-comment">        cmd: 表示对文件描述符进行如何操作</span><br><span class="hljs-comment">            - F_DUPFD : 复制文件描述符,复制的是第一个参数fd，得到一个新的文件描述符（返回值）</span><br><span class="hljs-comment">                int ret = fcntl(fd, F_DUPFD);</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">            - F_GETFL : 获取指定的文件描述符文件状态flag</span><br><span class="hljs-comment">              获取的flag和我们通过open函数传递的flag是一个东西。</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">            - F_SETFL : 设置文件描述符文件状态flag</span><br><span class="hljs-comment">              必选项：O_RDONLY, O_WRONLY, O_RDWR 不可以被修改</span><br><span class="hljs-comment">              可选性：O_APPEND, O)NONBLOCK</span><br><span class="hljs-comment">                O_APPEND 表示追加数据</span><br><span class="hljs-comment">                NONBLOK 设置成非阻塞</span><br><span class="hljs-comment">        </span><br><span class="hljs-comment">        阻塞和非阻塞：描述的是函数调用的行为。</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br><br>    <span class="hljs-comment">// 1.复制文件描述符</span><br>    <span class="hljs-comment">// int fd = open(&quot;1.txt&quot;, O_RDONLY);</span><br>    <span class="hljs-comment">// int ret = fcntl(fd, F_DUPFD);</span><br><br>    <span class="hljs-comment">// 2.修改或者获取文件状态flag</span><br>    <span class="hljs-type">int</span> fd = open(<span class="hljs-string">&quot;1.txt&quot;</span>, O_RDWR);<br>    <span class="hljs-keyword">if</span>(fd == <span class="hljs-number">-1</span>) &#123;<br>        perror(<span class="hljs-string">&quot;open&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 获取文件描述符状态flag</span><br>    <span class="hljs-type">int</span> flag = fcntl(fd, F_GETFL);<br>    <span class="hljs-keyword">if</span>(flag == <span class="hljs-number">-1</span>) &#123;<br>        perror(<span class="hljs-string">&quot;fcntl&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    flag |= O_APPEND;   <span class="hljs-comment">// flag = flag | O_APPEND</span><br><br>    <span class="hljs-comment">// 修改文件描述符状态的flag，给flag加入O_APPEND这个标记</span><br>    <span class="hljs-type">int</span> ret = fcntl(fd, F_SETFL, flag);<br>    <span class="hljs-keyword">if</span>(ret == <span class="hljs-number">-1</span>) &#123;<br>        perror(<span class="hljs-string">&quot;fcntl&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-type">char</span> * str = <span class="hljs-string">&quot;hello&quot;</span>;<br>    write(fd, str, <span class="hljs-built_in">strlen</span>(str));<br><br>    close(fd);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/C/" class="category-chain-item">C++</a> <span>></span> <a href="/categories/C/%E9%A1%B9%E7%9B%AE/" class="category-chain-item">项目</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/C/">#C++</a> <a href="/tags/Linux/">#Linux</a></div></div><div class="license-box my-3"><div class="license-title"><div>Linux 系统编程入门</div><div>https://ww1820.github.io/posts/bb4cd573/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>AWei</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2022年8月14日</div></div><div class="license-meta-item license-meta-date"><div>更新于</div><div>2022年8月14日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/posts/b76a0a04/" title="Linux 多进程开发（1）"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Linux 多进程开发（1）</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/posts/334154d9/" title="Ubuntu 升级 gcc-11"><span class="hidden-mobile">Ubuntu 升级 gcc-11</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a><div style="font-size:.85rem"><span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script src="/js/duration.js"></script></div></div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span><span id="busuanzi_container_site_uv" style="display:none">总访客数 <span id="busuanzi_value_site_uv"></span> 人</span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,i=t.getElementById("subtitle");i&&e&&e(i.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init({tocSelector:"#toc-body",contentSelector:".markdown-body",headingSelector:CONFIG.toc.headingSelector||"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:CONFIG.toc.collapseDepth||0,scrollSmooth:!0,headingsOffset:-t}),0<o.find(".toc-list-item").length&&o.css("visibility","visible"))})</script><script src="https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>